// -*- c-basic-offset: 4; c-backslash-column: 79; indent-tabs-mode: nil -*-
// vim:sw=4 ts=4 sts=4 expandtab
#ifndef CIFS_H_101221
#define CIFS_H_101221
#include <junkie/proto/proto.h>

/** @file
 * @brief CIFS informations
 */

extern struct proto *proto_cifs;

enum smb_status {
    SMB_STATUS_OK                               = 0x00000000,
    SMB_STATUS_ACCESS_DENIED                    = 0xC0000022,
    SMB_STATUS_NETWORK_ACCESS_DENIED            = 0xC00000CA,
    SMB_STATUS_ACCOUNT_DISABLED                 = 0xC0000072,
    SMB_STATUS_ACCOUNT_EXPIRED                  = 0xC0000193,
    SMB_STATUS_ALREADY_COMMITTED                = 0xC0000021,
    SMB_STATUS_BAD_DEVICE_TYPE                  = 0xC00000CB,
    SMB_STATUS_BAD_NETWORK_NAME                 = 0xC00000CC,
    SMB_STATUS_BUFFER_OVERFLOW                  = 0x80000005,
    SMB_STATUS_CANNOT_DELETE                    = 0xC0000121,
    SMB_STATUS_CRC_ERROR                        = 0xC000003F,
    SMB_STATUS_DATA_ERROR                       = 0xC000003E,
    SMB_STATUS_DATA_ERROR_UNUSED                = 0xC000009C,
    SMB_STATUS_DELETE_PENDING                   = 0xC0000056,
    SMB_STATUS_DEVICE_PAPER_EMPTY               = 0x8000000E,
    SMB_STATUS_DFS_EXIT_PATH_FOUND              = 0xC000009B,
    SMB_STATUS_DIRECTORY_NOT_EMPTY              = 0xC0000101,
    SMB_STATUS_DISK_CORRUPT_ERROR               = 0xC0000032,
    SMB_STATUS_DISK_FULL                        = 0xC000007F,
    SMB_STATUS_EAS_NOT_SUPPORTED                = 0xC000004F,
    SMB_STATUS_EA_TOO_LARGE                     = 0xC0000050,
    SMB_STATUS_END_OF_FILE                      = 0xC0000011,
    SMB_STATUS_FILE_CLOSED                      = 0xC0000128,
    SMB_STATUS_FILE_DELETED                     = 0xC0000123,
    SMB_STATUS_FILE_IS_A_DIRECTORY              = 0xC00000BA,
    SMB_STATUS_FILE_LOCK_CONFLICT               = 0xC0000054,
    SMB_STATUS_FILE_RENAMED                     = 0xC00000D5,
    SMB_STATUS_HANDLE_NOT_CLOSABLE              = 0xC0000235,
    SMB_STATUS_ILLEGAL_FUNCTION                 = 0xC00000AF,
    SMB_STATUS_INSTANCE_NOT_AVAILABLE           = 0xC00000AB,
    SMB_STATUS_INSUFF_SERVER_RESOURCES          = 0xC0000205,
    SMB_STATUS_INVALID_DEVICE_REQUEST           = 0xC0000010,
    SMB_STATUS_INVALID_DEVICE_STATE             = 0xC0000184,
    SMB_STATUS_INVALID_HANDLE                   = 0xC0000008,
    SMB_STATUS_INVALID_INFO_CLASS               = 0xC0000003,
    SMB_STATUS_INVALID_LOCK_SEQUENCE            = 0xC000001E,
    SMB_STATUS_INVALID_LOGON_HOURS              = 0xC000006F,
    SMB_STATUS_INVALID_PARAMETER                = 0xC000000D,
    SMB_STATUS_INVALID_PIPE_STATE               = 0xC00000AD,
    SMB_STATUS_INVALID_PORT_HANDLE              = 0xC0000042,
    SMB_STATUS_INVALID_READ_MODE                = 0xC00000B4,
    SMB_STATUS_INVALID_SMB                      = 0x00010002,
    SMB_STATUS_INVALID_VIEW_SIZE                = 0xC000001F,
    SMB_STATUS_INVALID_WORKSTATION              = 0xC0000070,
    SMB_STATUS_IO_TIMEOUT                       = 0xC00000B5,
    SMB_STATUS_LOCK_NOT_GRANTED                 = 0xC0000055,
    SMB_STATUS_LOGON_FAILURE                    = 0xC000006D,
    SMB_STATUS_MEDIA_WRITE_PROTECTED            = 0xC00000A2,
    SMB_STATUS_MORE_PROCESSING_REQUIRED         = 0xC0000016,
    SMB_STATUS_NETWORK_NAME_DELETED             = 0xC00000C9,
    SMB_STATUS_NO_MEDIA_IN_DEVICE               = 0xC0000013,
    SMB_STATUS_NO_MORE_FILES                    = 0x80000006,
    SMB_STATUS_NONEXISTENT_SECTOR               = 0xC0000015,
    SMB_STATUS_NO_SPOOL_SPACE                   = 0xC00000C7,
    SMB_STATUS_NO_SUCH_DEVICE                   = 0xC000000E,
    SMB_STATUS_NO_SUCH_FILE                     = 0xC000000F,
    SMB_STATUS_NOTIFY_ENUM_DIR                  = 0x0000010C,
    SMB_STATUS_NOT_IMPLEMENTED                  = 0xC0000002,
    SMB_STATUS_NOT_SAME_DEVICE                  = 0xC00000D4,
    SMB_STATUS_NOT_SUPPORTED                    = 0XC00000BB,
    SMB_STATUS_OBJECT_NAME_COLLISION            = 0xC0000035,
    SMB_STATUS_OBJECT_NAME_NOT_FOUND            = 0xC0000034,
    SMB_STATUS_OBJECT_PATH_INVALID              = 0xC0000039,
    SMB_STATUS_OBJECT_PATH_NOT_FOUND            = 0xC000003A,
    SMB_STATUS_OBJECT_PATH_SYNTAX_BAD           = 0xC000003B,
    SMB_STATUS_OBJECT_TYPE_MISMATCH             = 0xC0000024,
    SMB_STATUS_OS2_ATOMIC_LOCKS_NOT_SUPPORTED   = 0x00AE0001,
    SMB_STATUS_OS2_CANCEL_VIOLATION             = 0x00AD0001,
    SMB_STATUS_OS2_CANNOT_COPY                  = 0x010A0001,
    SMB_STATUS_OS2_EA_ACCESS_DENIED             = 0x03E20001,
    SMB_STATUS_OS2_EAS_DIDNT_FIT                = 0x01130001,
    SMB_STATUS_OS2_INVALID_ACCESS               = 0x000C0001,
    SMB_STATUS_OS2_INVALID_LEVEL                = 0x007C0001,
    SMB_STATUS_OS2_NEGATIVE_SEEK                = 0x00830001,
    SMB_STATUS_OS2_NO_MORE_SIDS                 = 0x00710001,
    SMB_STATUS_PASSWORD_EXPIRED                 = 0xC0000071,
    SMB_STATUS_PASSWORD_MUST_CHANGE             = 0xC0000224,
    SMB_STATUS_PATH_NOT_COVERED                 = 0xC0000257,
    SMB_STATUS_PIPE_BUSY                        = 0xC00000AE,
    SMB_STATUS_PIPE_CLOSING                     = 0xC00000B1,
    SMB_STATUS_PIPE_DISCONNECTED                = 0xC00000B0,
    SMB_STATUS_PIPE_EMPTY                       = 0xC00000D9,
    SMB_STATUS_PIPE_NOT_AVAILABLE               = 0xC00000AC,
    SMB_STATUS_PORT_CONNECTION_REFUSED          = 0xC0000041,
    SMB_STATUS_PORT_DISCONNECTED                = 0xC0000037,
    SMB_STATUS_PRINT_CANCELLED                  = 0xC00000C8,
    SMB_STATUS_PRINT_QUEUE_FULL                 = 0xC00000C6,
    SMB_STATUS_PRIVILEGE_NOT_HELD               = 0xC0000061,
    SMB_STATUS_PROCESS_IS_TERMINATING           = 0xC000010A,
    SMB_STATUS_RANGE_NOT_LOCKED                 = 0xC000007E,
    SMB_STATUS_REDIRECTOR_NOT_STARTED           = 0xC00000FB,
    SMB_STATUS_REQUEST_NOT_ACCEPTED             = 0xC00000D0,
    SMB_STATUS_SECTION_TOO_BIG                  = 0xC0000040,
    SMB_STATUS_SHARING_VIOLATION                = 0xC0000043,
    SMB_STATUS_SMB_BAD_COMMAND                  = 0x00160002,
    SMB_STATUS_SMB_BAD_FID                      = 0x00060001,
    SMB_STATUS_SMB_BAD_TID                      = 0x00050002,
    SMB_STATUS_SMB_BAD_UID                      = 0x005B0002,
    SMB_STATUS_SMB_CONTINUE_MPX                 = 0x00FC0002,
    SMB_STATUS_SMB_NO_SUPPORT                   = 0XFFFF0002,
    SMB_STATUS_SMB_USE_MPX                      = 0x00FA0002,
    SMB_STATUS_SMB_USE_STANDARD                 = 0x00FB0002,
    SMB_STATUS_THREAD_IS_TERMINATING            = 0xC000004B,
    SMB_STATUS_TOO_MANY_OPENED_FILES            = 0xC000011F,
    SMB_STATUS_TOO_MANY_PAGING_FILES            = 0xC0000097,
    SMB_STATUS_TOO_MANY_SESSIONS                = 0xC00000CE,
    SMB_STATUS_UNEXPECTED_NETWORK_ERROR         = 0xC00000C4,
    SMB_STATUS_UNSUCCESSFUL                     = 0xC0000001,
    SMB_STATUS_WRONG_PASSWORD                   = 0xC000006A,
    SMB_STATUS_WRONG_VOLUME                     = 0xC0000012,
};

enum smb_trans2_subcommand {
    SMB_TRANS2_OPEN2 = 0x0000,
    SMB_TRANS2_FIND_FIRST2 = 0x0001,
    SMB_TRANS2_FIND_NEXT2 = 0x0002,
    SMB_TRANS2_QUERY_FS_INFO = 0x0003,
    SMB_TRANS2_SET_FS_INFORMATION = 0x0004,
    SMB_TRANS2_QUERY_PATH_INFORMATION = 0x0005,
    SMB_TRANS2_SET_PATH_INFORMATION = 0x0006,
    SMB_TRANS2_QUERY_FILE_INFORMATION = 0x0007,
    SMB_TRANS2_SET_FILE_INFORMATION = 0x0008,
    SMB_TRANS2_FSCTL = 0x0009,
    SMB_TRANS2_IOCTL2 = 0x000a,
    SMB_TRANS2_FIND_NOTIFY_FIRST = 0x000b,
    SMB_TRANS2_FIND_NOTIFY_NEXT = 0x000c,
    SMB_TRANS2_CREATE_DIRECTORY = 0x000d,
    SMB_TRANS2_SESSION_SETUP = 0x000e,
    SMB_TRANS2_GET_DFS_REFERRAL = 0x0010,
    SMB_TRANS2_REPORT_DFS_INCONSISTENCY = 0x0011,
};

enum smb_command {
    SMB_COM_CREATE_DIRECTORY        = 0x00,
    SMB_COM_DELETE_DIRECTORY,
    SMB_COM_OPEN,
    SMB_COM_CREATE,
    SMB_COM_CLOSE,
    SMB_COM_FLUSH,
    SMB_COM_DELETE,
    SMB_COM_RENAME,
    SMB_COM_QUERY_INFORMATION,
    SMB_COM_SET_INFORMATION,
    SMB_COM_READ_INFORMATION,
    SMB_COM_WRITE_INFORMATION,
    SMB_COM_LOCK_BYTE_RANGE,
    SMB_COM_UNLOCK_BYTE_RANGE,
    SMB_COM_CREATE_TEMPORARY,
    SMB_COM_CREATE_NEW,
    SMB_COM_CHECK_DIRECTORY,
    SMB_COM_PROCESS_EXIT,
    SMB_COM_SEEK,
    SMB_COM_LOCK_AND_READ,
    SMB_COM_WRITE_AND_UNLOCK,

    SMB_COM_READ_RAW                = 0x1a,
    SMB_COM_READ_MPX,
    SMB_COM_READ_MPX_SECONDARY,
    SMB_COM_WRITE_RAW,
    SMB_COM_WRITE_MPX,
    SMB_COM_WRITE_MPX_SECONDARY,
    SMB_COM_WRITE_COMPLETE,
    SMB_COM_QUERY_SERVER,
    SMB_COM_SET_INFORMATION2,
    SMB_COM_QUERY_INFORMATION2,
    SMB_COM_LOCKING_ANDX,
    SMB_COM_TRANSACTION,
    SMB_COM_TRANSACTION_SECONDARY,
    SMB_COM_IOCTL,
    SMB_COM_IOCTL_SECONDARY,
    SMB_COM_COPY,
    SMB_COM_MOVE,
    SMB_COM_ECHO,
    SMB_COM_WRITE_AND_CLOSE,
    SMB_COM_OPEN_ANDX,
    SMB_COM_READ_ANDX,
    SMB_COM_WRITE_ANDX,
    SMB_COM_NEW_FILE_SIZE,
    SMB_COM_CLOSE_AND_TREE_DISC,
    SMB_COM_TRANSACTION2,
    SMB_COM_TRANSACTION2_SECONDARY,
    SMB_COM_FIND_CLOSE2,
    SMB_COM_FIND_NOTIFY_CLOSE,

    SMB_COM_TREE_CONNECT            = 0x70,
    SMB_COM_TREE_DISCONNECT,
    SMB_COM_NEGOCIATE,
    SMB_COM_SESSION_SETUP_ANDX,
    SMB_COM_LOGOFF_ANDX,
    SMB_COM_TREE_CONNECT_ANDX       = 0x75,

    SMB_COM_SECURITY_PACKAGE_ANDX   = 0x7e,
    SMB_COM_QUERY_INFORMATION_DISK  = 0x80,
    SMB_COM_SEARCH,
    SMB_COM_FIND,
    SMB_COM_FIND_UNIQUE,
    SMB_COM_FIND_CLOSE              = 0x84,
    SMB_COM_NT_TRANSACT             = 0xa0,
    SMB_COM_NT_TRANSACT_SECONDARY,
    SMB_COM_NT_CREATE_ANDX,
    SMB_COM_NT_CANCEL               = 0xa4,
    SMB_COM_NT_RENAME,
    SMB_COM_OPEN_PRINT_FILE         = 0xc0,
    SMB_COM_WRITE_PRINT_FILE,
    SMB_COM_CLOSE_PRINT_FILE,
    SMB_COM_GET_PRINT_FILE,
    SMB_COM_READ_BULK               = 0xd8,
    SMB_COM_WRITE_BULK,
    SMB_COM_WRITE_BULK_DATA,
    SMB_COM_INVALID                 = 0xfe,
    SMB_COM_NO_ANDX_COMMAND
};

struct cifs_proto_info {
    struct proto_info info;
    enum smb_command command;
    enum smb_status status;
#define         SMB_DOMAIN                            0x0001
#define         SMB_USER                              0x0002
#define         SMB_PATH                              0x0004
#define         SMB_TRANS2_SUBCMD                     0x0008
#define         SMB_FID                               0x0010
    unsigned set_values;
    char domain[50];
    char user[50];
    char path[50];
    enum smb_trans2_subcommand trans2_subcmd;
    uint16_t fid;
};

void cifs_init(void);
void cifs_fini(void);

#endif
