// -*- c-basic-offset: 4; c-backslash-column: 79; indent-tabs-mode: nil -*-
// vim:sw=4 ts=4 sts=4 expandtab
#include <stdlib.h>
#undef NDEBUG
#include <assert.h>
#include <junkie/cpp.h>
#include <junkie/tools/ext.h>
#include <junkie/tools/objalloc.h>
#include <junkie/proto/pkt_wait_list.h>
#include <junkie/proto/cap.h>
#include <junkie/proto/ip.h>
#include <junkie/proto/eth.h>
#include <junkie/proto/tcp.h>
#include "lib_test_junkie.h"
#include "proto/netbios.c"
#include "proto/cifs.c"

static struct parse_test {
    char const *name;
    uint8_t const *packet;
    int size;
    enum proto_parse_status ret;
    struct cifs_proto_info expected;
    bool way;
} parse_tests[] = {

    {
        .name = "A negociate response",
        .packet = (uint8_t const []) {
//          Header-{-               Nego
            0xff, 0x53, 0x4d, 0x42, 0x72, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
//                                                                                                      -}
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x47, 0x00, 0x00, 0x01, 0x00,
//          WC-
            0x11, 0x02, 0x00, 0x03, 0x32, 0x00, 0x01, 0x00, 0x04, 0x41, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
//                                  Capabilities----------
            0xcc, 0x77, 0x00, 0x00, 0xfd, 0xf3, 0x80, 0x00, 0x00, 0xb5, 0x65, 0x00, 0x86, 0x6f, 0xcf, 0x01,
//                      Chal  BC--------                                                  Workgroup-------
            0x88, 0xff, 0x08, 0x1c, 0x00, 0xbc, 0x52, 0x94, 0xe1, 0x5d, 0xf2, 0x8f, 0x5f, 0x57, 0x00, 0x4f,
//          ----------------------------------------------------------------------------------------------
            0x00, 0x52, 0x00, 0x4b, 0x00, 0x47, 0x00, 0x52, 0x00, 0x4f, 0x00, 0x55, 0x00, 0x50, 0x00, 0x00,
//          ----
            0x00
        },
        .size = 0x61,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x61 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_NEGOCIATE ,
            .domain = "WORKGROUP",
            .set_values = CIFS_DOMAIN,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x01,
        },
    },

    {
        .name = "An ntlm 0.12 negociate response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x72, 0x00, 0x00, 0x00, 0x00, 0x88, 0x01, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xca, 0x6b, 0x00, 0x00, 0x01, 0x00,
            0x11, 0x08, 0x00, 0x03, 0x32, 0x00, 0x01, 0x00, 0x04, 0x11, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0xfc, 0xe3, 0x01, 0x80, 0x29, 0xd1, 0x2d, 0xea, 0x67, 0x94, 0xcf, 0x01,
            0x88, 0xff, 0x00, 0x25, 0x01, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11,
            0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x00, 0x00
        },
        .size = 0x16a,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x16a - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_NEGOCIATE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x01,
        },
    },

    {
        .name = "Session setup andx query",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x59, 0x00, 0x00, 0x0e, 0x00,
            0x0d, 0xff, 0x00, 0x00, 0x00, 0x54, 0x40, 0x32, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18,
            0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0xdc, 0xd0, 0x80, 0x00, 0xa9, 0x00, 0x75, 0xd9, 0x4e,
            0xda, 0xbf, 0x5f, 0x86, 0xf1, 0xa4, 0x52, 0x97, 0x2d, 0x45, 0x05, 0xe4, 0x69, 0x06, 0xcd, 0xdb,
            0xaa, 0xe9, 0x89, 0x16, 0x6e, 0x75, 0xd9, 0x4e, 0xda, 0xbf, 0x5f, 0x86, 0xf1, 0xa4, 0x52, 0x97,
            0x2d, 0x45, 0x05, 0xe4, 0x69, 0x06, 0xcd, 0xdb, 0xaa, 0xe9, 0x89, 0x16, 0x6e, 0x00, 0x72, 0x00,
            0x6f, 0x00, 0x6f, 0x00, 0x74, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4c, 0x00, 0x69, 0x00, 0x6e, 0x00,
            0x75, 0x00, 0x78, 0x00, 0x20, 0x00, 0x76, 0x00, 0x65, 0x00, 0x72, 0x00, 0x73, 0x00, 0x69, 0x00,
            0x6f, 0x00, 0x6e, 0x00, 0x20, 0x00, 0x33, 0x00, 0x2e, 0x00, 0x32, 0x00, 0x2e, 0x00, 0x30, 0x00,
            0x2d, 0x00, 0x34, 0x00, 0x2d, 0x00, 0x61, 0x00, 0x6d, 0x00, 0x64, 0x00, 0x36, 0x00, 0x34, 0x00,
            0x00, 0x00, 0x43, 0x00, 0x49, 0x00, 0x46, 0x00, 0x53, 0x00, 0x20, 0x00, 0x56, 0x00, 0x46, 0x00,
            0x53, 0x00, 0x20, 0x00, 0x43, 0x00, 0x6c, 0x00, 0x69, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x74, 0x00,
            0x20, 0x00, 0x66, 0x00, 0x6f, 0x00, 0x72, 0x00, 0x20, 0x00, 0x4c, 0x00, 0x69, 0x00, 0x6e, 0x00,
            0x75, 0x00, 0x78, 0x00, 0x00, 0x00
        },
        .size = 0xe6,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xe6 - SMB_HEADER_SIZE},
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .user = "root",
            .driver = "CIFS VFS Client for Linux",
            .os = "Linux version 3.2.0-4-amd64",
            .set_values = CIFS_USER | CIFS_DRIVER | CIFS_OS,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x0e,
        },
    },

    {
        .name = "Smb, Session setup request, Kerberos authentification",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x42, 0x53,
            0x52, 0x53, 0x50, 0x59, 0x4c, 0x20, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x40, 0x00,
            0x0c, 0xff, 0x00, 0x00, 0x00, 0x04, 0x41, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xeb,
            0x0a, 0x00, 0x00, 0x00, 0x00, 0xd4, 0x00, 0x00, 0xa0, 0xef, 0x0a, 0x60, 0x82, 0x0a, 0xe7, 0x06,
            0x06, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x02, 0xa0, 0x82, 0x0a, 0xdb, 0x30, 0x82, 0x0a, 0xd7, 0xa0,
            0x30, 0x30, 0x2e, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x82, 0xf7, 0x12, 0x01, 0x02, 0x02, 0x06, 0x09,
            0x2a, 0x86, 0x48, 0x86, 0xf7, 0x12, 0x01, 0x02, 0x02, 0x06, 0x0a, 0x2b, 0x06, 0x01, 0x04, 0x01,
            0x82, 0x37, 0x02, 0x02, 0x1e, 0x06, 0x0a, 0x2b, 0x06, 0x01, 0x04, 0x01, 0x82, 0x37, 0x02, 0x02,
            0x0a, 0xa2, 0x82, 0x0a, 0xa1, 0x04, 0x82, 0x0a, 0x9d, 0x60, 0x82, 0x0a, 0x99, 0x06, 0x09, 0x2a,
            0x86, 0x48, 0x86, 0xf7, 0x12, 0x01, 0x02, 0x02, 0x01, 0x00, 0x6e, 0x82, 0x0a, 0x88, 0x30, 0x82,
            0x0a, 0x84, 0xa0, 0x03, 0x02, 0x01, 0x05, 0xa1, 0x03, 0x02, 0x01, 0x0e, 0xa2, 0x07, 0x03, 0x05,
            0x00, 0x20, 0x00, 0x00, 0x00, 0xa3, 0x82, 0x04, 0x42, 0x61, 0x82, 0x04, 0x3e, 0x30, 0x82, 0x04,
            0x3a, 0xa0, 0x03, 0x02, 0x01, 0x05, 0xa1, 0x12, 0x1b, 0x10,  'T',  'E',  'S',  'T',  'R',  'O',
            'Y' , 'A' , 'U' , 'M' , 'E' , 'S' , '.' , 'C' , 'O' , 'M' , 0xa2, 0x2a, 0x30, 0x28, 0xa0, 0x03,
            0x02, 0x01, 0x02, 0xa1, 0x21, 0x30, 0x1f, 0x1b, 0x04, 0x63, 0x69, 0x66, 0x73, 0x1b, 0x17, 't' ,
            'e' , 's' , 't' , 's' , 'e' , 'r' , 'v' , 'e' , 'r' , 'n' , 'a' , 'm' , 'e' , 'r' , 'e' , 'a' ,
            'l' , 'm' , '.' , 'c' , 'o' , 'm' , 0xa3, 0x82, 0x03, 0xf1
        },
        .size = 0xb2a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xb2a - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .tree_id = 0xffff,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x40,
            .set_values = CIFS_DOMAIN,
            .domain = "TESTROYAUMES.COM",
        }
    },

    {
        .name = "Smb, Session setup request, user anonymous",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x08, 0x01, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xca, 0x6b, 0x00, 0x00, 0x02, 0x00,
            0x0d, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0x02, 0x00, 0xca, 0x6b, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0xc0, 0x00, 0x00, 0x1b, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x55, 0x00, 0x6e, 0x00, 0x69, 0x00, 0x78, 0x00, 0x00, 0x00, 0x53, 0x00, 0x61, 0x00,
            0x6d, 0x00, 0x62, 0x00, 0x61, 0x00, 0x00, 0x00
        },
        .size = 0x58,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x58 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .tree_id = 0,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 2,
            .set_values = CIFS_USER | CIFS_DRIVER | CIFS_OS,
            .user = "",
            .driver = "Samba",
            .os = "Unix",
        }
    },

    {
        .name = "Smb, Session setup response, workgroup domain",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x88, 0x01, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xca, 0x6b, 0x00, 0x08, 0x02, 0x00,
            0x03, 0xff, 0x00, 0x87, 0x00, 0x00, 0x00, 0x5e, 0x00, 0x11, 0x57, 0x00, 0x69, 0x00, 0x6e, 0x00,
            0x64, 0x00, 0x6f, 0x00, 0x77, 0x00, 0x73, 0x00, 0x20, 0x00, 0x38, 0x00, 0x20, 0x00, 0x50, 0x00,
            0x72, 0x00, 0x6f, 0x00, 0x20, 0x00, 0x39, 0x00, 0x32, 0x00, 0x30, 0x00, 0x30, 0x00, 0x00, 0x00,
            0x57, 0x00, 0x69, 0x00, 0x6e, 0x00, 0x64, 0x00, 0x6f, 0x00, 0x77, 0x00, 0x73, 0x00, 0x20, 0x00,
            0x38, 0x00, 0x20, 0x00, 0x50, 0x00, 0x72, 0x00, 0x6f, 0x00, 0x20, 0x00, 0x36, 0x00, 0x2e, 0x00,
//                                  Workgroup
            0x32, 0x00, 0x00, 0x00, 0x57, 0x00, 0x4f, 0x00, 0x52, 0x00, 0x4b, 0x00, 0x47, 0x00, 0x52, 0x00,
            0x4f, 0x00, 0x55, 0x00, 0x50, 0x00, 0x00
        },
        .size = 0x87,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x87 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .tree_id = 0,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 2,
            .set_values = CIFS_DOMAIN | CIFS_SERVER_OS,
            .domain = "WORKGROUP",
            .os = "Windows 8 Pro 9200",
        }
    },

    {
        .name = "Session setup andx response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x47, 0x64, 0x00, 0x02, 0x00,
            0x03, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x55, 0x00, 0x6e, 0x00, 0x69, 0x00,
            0x78, 0x00, 0x00, 0x00, 0x53, 0x00, 0x61, 0x00, 0x6d, 0x00, 0x62, 0x00, 0x61, 0x00, 0x20, 0x00,
            0x33, 0x00, 0x2e, 0x00, 0x35, 0x00, 0x2e, 0x00, 0x36, 0x00, 0x00, 0x00, 0x57, 0x00, 0x4f, 0x00,
            0x52, 0x00, 0x4b, 0x00, 0x47, 0x00, 0x52, 0x00, 0x4f, 0x00, 0x55, 0x00, 0x50, 0x00, 0x00, 0x00
        },
        .size = 0x60,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x60 - SMB_HEADER_SIZE},
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .domain = "WORKGROUP",
            .os = "Unix",
            .set_values = CIFS_DOMAIN | CIFS_SERVER_OS,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x02,
        },
    },

    {
        .name = "Session response with error",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x6d, 0x00, 0x00, 0xc0, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x59, 0x00, 0x00, 0x0e, 0x00,
            0x00, 0x00, 0x00
        },
        .size = 0x23,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x23 - SMB_HEADER_SIZE},
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .status = SMB_STATUS_LOGON_FAILURE,
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x0e,
        },
    },

    {
        .name = "Trans2 request, query fs info",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x3b, 0x6c, 0x64, 0x00, 0x0f, 0x00,
            0x0f, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x02, 0x00, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x03, 0x00, 0x03,
            0x00, 0x00, 0x01, 0x02
        },
        .size = 0x44,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x44 - SMB_HEADER_SIZE},
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_TRANS2_SUBCMD,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_QUERY_FS_INFO,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x0f,
        },
    },

    {
        .name = "Trans2 request, query path info",
        .packet = (uint8_t const []) {
//          Start
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xec, 0x1a, 0x64, 0x00, 0x19, 0x00,
            0x0f, 0x28, 0x00, 0x00, 0x00, 0x02, 0x00, 0xa0, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x28, 0x00, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x05, 0x00, 0x29,
//                Padd
            0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x00, 0x6c, 0x00, 0x69, 0x00, 0x62, 0x00,
            0x70, 0x00, 0x74, 0x00, 0x68, 0x00, 0x72, 0x00, 0x65, 0x00, 0x61, 0x00, 0x64, 0x00, 0x2e, 0x00,
            0x73, 0x00, 0x6f, 0x00, 0x2e, 0x00, 0x30, 0x00, 0x00, 0x00
        },
        .size = 0x6a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x6a - SMB_HEADER_SIZE},
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_QUERY_PATH_INFORMATION,
            },
            .path = "/libpthread.so.0",
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x19,
        },
    },

    {
        .name = "Trans2 response, query path info response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x34, 0x00, 0x00, 0xc0, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xec, 0x1a, 0x64, 0x00, 0x19, 0x00,
            0x00, 0x00, 0x00
        },
        .size = 0x23,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x23 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OBJECT_NAME_NOT_FOUND,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x19,
        },
    },

    {
        .name = "Trans2 request, find first query",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xec, 0x1a, 0x64, 0x00, 0x1b, 0x00,
            0x0f, 0x12, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x12, 0x00, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x13,
            0x00, 0x00, 0x17, 0x00, 0x96, 0x00, 0x06, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x00,
            0x2a, 0x00, 0x00, 0x00
        },
        .size = 0x54,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x54 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_FIND_FIRST2,
            },
            .status = SMB_STATUS_OK,
            .path = "/*",
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x1b,
        },
    },

    {
        .name = "SMB_TRANS2_FIND_FIRST2 - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x08, 0x00,
            0x0a, 0x0a, 0x00, 0xcc, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x38, 0x00, 0x00, 0x00, 0xcc, 0x00, 0x44,
            0x00, 0x00, 0x00, 0x00, 0x00, 0xd9, 0x00, 0x00, 0x00, 0x08, 0x02, 0x00, 0x01, 0x00, 0x00, 0x00,
            0x64, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0xb5, 0x9d, 0xb5,
            0xb9, 0xec, 0xc5, 0x01, 0xda, 0x5b, 0x87, 0xb6, 0xb9, 0xec, 0xc5, 0x01, 0xda, 0x5b, 0x87, 0xb6,
            0xb9, 0xec, 0xc5, 0x01, 0xda, 0x5b, 0x87, 0xb6, 0xb9, 0xec, 0xc5, 0x01, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
            0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x66, 0xb5, 0x9d, 0xb5, 0xb9, 0xec, 0xc5, 0x01, 0xda, 0x5b, 0x87, 0xb6, 0xb9, 0xec, 0xc5, 0x01,
            0xda, 0x5b, 0x87, 0xb6, 0xb9, 0xec, 0xc5, 0x01, 0xda, 0x5b, 0x87, 0xb6, 0xb9, 0xec, 0xc5, 0x01,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x00, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x110,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x110 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0xcc,
            .ids.multiplex_id = 0x08,
        },
    },

    {
        .name = "Trans2 request, set_path_info query",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x89, 0x00,
            0x0f, 0x20, 0x00, 0x12, 0x00, 0x02, 0x00, 0xe8, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//                                        ParameterO                                                  Byte
            0x00, 0x00, 0x00, 0x20, 0x00, 0x44, 0x00, 0x12, 0x00, 0x64, 0x00, 0x01, 0x00, 0x06, 0x00, 0x35,
//          Coun  Padding---------  LevelOfInt
            0x00, 0x00, 0x00, 0x00, 0x09, 0x02, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x00, 0x74, 0x00, 0x6d, 0x00,
            0x70, 0x00, 0x2f, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x2f, 0x00, 0x67, 0x00,
            0x61, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x52, 0x00, 0x00, 0x00, 0xed, 0x01, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x02
        },
        .size = 0x76,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x76 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH | CIFS_LEVEL_OF_INTEREST,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_SET_PATH_INFORMATION,
            },
            .status = SMB_STATUS_OK,
            .flag_file = CIFS_FILE_CREATE,
            .level_of_interest = SMB_POSIX_PATH_OPEN,
            .path = "/tmp/test/ga",
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .meta_write_bytes = 0x12,
            .ids.multiplex_id = 0x89,
        },
    },

    {
        .name = "Trans2 response, set_path_info response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x89, 0x00,
            0x0a, 0x02, 0x00, 0x70, 0x00, 0x00, 0x00, 0x02, 0x00, 0x38, 0x00, 0x00, 0x00, 0x70, 0x00, 0x3c,
//                                        BC--------  Padd  ErrorOffset Padding---  Flag-Field  FID-------
            0x00, 0x00, 0x00, 0x00, 0x00, 0x75, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x38, 0x18,
//          Create
            0x03, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc7, 0xae, 0x03, 0x2c, 0x00, 0x71, 0xcf, 0x01,
            0xd9, 0x8f, 0x8b, 0x05, 0x00, 0x71, 0xcf, 0x01, 0xc7, 0xae, 0x03, 0x2c, 0x00, 0x71, 0xcf, 0x01,
            0xe3, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd0, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0xa5, 0x13, 0xbc, 0x01, 0x00, 0x00, 0x00, 0x00, 0xff, 0x01, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0xac,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xac - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .fid = 0x1838,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x89,
        },
    },

    {
        .name = "Trans2 request, set_file_info, set eof information",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x8a, 0x00,
            0x0f, 0x06, 0x00, 0x08, 0x00, 0x02, 0x00, 0xe8, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x06, 0x00, 0x44, 0x00, 0x08, 0x00, 0x4a, 0x00, 0x01, 0x00, 0x08, 0x00, 0x11,
            0x00, 0x00, 0x00, 0x00, 0x38, 0x18, 0xfc, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00
        },
        .size = 0x52,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x52 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_FID | CIFS_TRANS2_SUBCMD,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_SET_FILE_INFORMATION,
            },
            .status = SMB_STATUS_OK,
            .fid = 0x1838,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .meta_write_bytes = 0x8,
            .ids.multiplex_id = 0x8a,
        },
    },

    {
        .name = "Trans2 request, set_file_info, set file unix basic",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x8b, 0x00,
            0x0f, 0x06, 0x00, 0x64, 0x00, 0x02, 0x00, 0xe8, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x06, 0x00, 0x44, 0x00, 0x64, 0x00, 0x4a, 0x00, 0x01, 0x00, 0x08, 0x00, 0x6d,
            0x00, 0x00, 0x00, 0x00, 0x38, 0x18, 0x00, 0x02, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x82, 0xd9, 0xd6, 0x7d, 0x00, 0x71,
            0xcf, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x82, 0xd9, 0xd6, 0x7d, 0x00, 0x71,
            0xcf, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0xae,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xae - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .set_values = CIFS_FID | CIFS_TRANS2_SUBCMD,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_SET_FILE_INFORMATION,
            },
            .status = SMB_STATUS_OK,
            .fid = 0x1838,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .meta_write_bytes = 0x64,
            .ids.multiplex_id = 0x8b,
        },
    },

    {
        .name = "Write andx request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x8c, 0x00,
            0x0e, 0xff, 0x00, 0x00, 0x00, 0x38, 0x18, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
            0x74, 0x65, 0x73, 0x74, 0x0a
        },
        .size = 0x45,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x45 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE_ANDX,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .fid = 0x1838,
            .query_write_bytes = 0x05,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x8c,
        },
    },

    {
        .name = "Write andx response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2f, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x8c, 0x00,
            0x06, 0xff, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x2f,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2f - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE_ANDX,
            .status = SMB_STATUS_OK,
            .response_write_bytes = 0x05,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x8c,
        },
    },

    {
        .name = "SMB_COM_WRITE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x0a, 0x00,
            0x05, 0x00, 0x40, 0x09, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x01, 0x09, 0x00,
            0x25, 0x3c, 0xd8, 0x5d, 0x54, 0x63, 0x79, 0xae, 0x53
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .fid = 0x4000,
            .query_write_bytes = 0x9,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0a,
        },
    },

    {
        .name = "SMB_COM_WRITE - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x0a, 0x00,
            0x01, 0x09, 0x00, 0x00, 0x00
        },
        .size = 0x25,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x25 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE,
            .status = SMB_STATUS_OK,
            .response_write_bytes = 0x9,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0a,
        },
    },

    {
        .name = "SMB_COM_READ - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0d, 0x00,
            0x05, 0x00, 0x40, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_READ,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .fid = 0x4000,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0d,
        },
    },

    {
        .name = "SMB_COM_READ - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0d, 0x00,
            0x05, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x01, 0x09, 0x00,
            0x54, 0x45, 0x53, 0x54, 0x20, 0x44, 0x41, 0x54, 0x41
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_READ,
            .status = SMB_STATUS_OK,
            .response_read_bytes = 0x9,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0d,
        },
    },

    {
        .name = "Close Request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x62, 0x33, 0x64, 0x00, 0x8d, 0x00,
            0x03, 0x38, 0x18, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00
        },
        .size = 0x29,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x29 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CLOSE,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .fid = 0x1838,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x8d,
        },
    },

    {
        .name = "Read AnxX Request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x59, 0x1a, 0x64, 0x00, 0x77, 0x00,
            0x0c, 0xff, 0x00, 0x00, 0x00, 0x1a, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x3b,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x3b - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_READ_ANDX,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .fid = 0x191a,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x77,
        },
    },

    {
        .name = "Read AnxX Response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x59, 0x1a, 0x64, 0x00, 0x77, 0x00,
            0x0c, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x3b, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x63, 0x6f, 0x6e, 0x74, 0x65,
            0x6e, 0x74, 0x0a
        },
        .size = 0x43,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x43 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_READ_ANDX,
            .status = SMB_STATUS_OK,
            .response_read_bytes = 8,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x77,
        },
    },

    {
        .name = "Tree Connect AndX Request",
        .packet = (uint8_t const []) {
            0xff , 0x53 , 0x4d , 0x42 , 0x75 , 0x00 , 0x00 , 0x00 , 0x00 , 0x18 , 0x07 , 0xc8 , 0x00 , 0x00 , 0xda , 0xe3 ,
            0xa6 , 0xab , 0x6e , 0xe7 , 0xb0 , 0x99 , 0x00 , 0x00 , 0x00 , 0x00 , 0xff , 0xfe , 0x01 , 0x38 , 0xc0 , 0x1e ,
            0x04 , 0xff , 0x00 , 0x4a , 0x00 , 0x08 , 0x00 , 0x01 , 0x00 , 0x1f , 0x00 , 0x00 , '\\' , 0x00 , '\\' , 0x00 ,
            'T'  , 0x00 , 'E'  , 0x00 , 'S'  , 0x00 , 'T'  , 0x00 , '\\' , 0x00 , 't'  , 0x00 , 'o'  , 0x00 , 't'  , 0x00 ,
            'o'  , 0x00 , 0x00 , 0x00 , 0x3f , 0x3f , 0x3f , 0x3f , 0x3f , 0x00
        },
        .size = 0x4a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x4a - SMB_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb_command = SMB_COM_TREE_CONNECT_ANDX,
            .status = SMB_STATUS_OK,
            .path = "\\\\TEST\\toto",
            .version = SMB_VERSION_1,
            .ids.multiplex_id = 0x1ec0,
        },
    },

    {
        .name = "SMB_COM_CREATE_DIRECTORY - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x07, 0x00,
            0x00, 0x19, 0x00, 0x04, 0x5c, 0x00, 0x72, 0x00, 0x61, 0x00, 0x77, 0x00, 0x63, 0x00, 0x6f, 0x00,
            0x6e, 0x00, 0x74, 0x00, 0x65, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00
        },
        .size = 0x4a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x4a - SMB_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb_command = SMB_COM_CREATE_DIRECTORY,
            .status = SMB_STATUS_OK,
            .path = "\\rawcontext",
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x07,
        },
    },

    {
        .name = "SMB_COM_QUERY_INFORMATION_DISK - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x80, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x05, 0x00,
            0x05, 0xef, 0x9f, 0x00, 0x02, 0x00, 0x02, 0x1f, 0x37, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x2d,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2d - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_QUERY_INFORMATION_DISK,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0xa,
            .ids.multiplex_id = 0x05,
        },
    },

    {
        .name = "SMB_COM_CHECK_DIRECTORY - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x10, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x38, 0x00,
            0x00, 0x25, 0x00, 0x04, 0x5c, 0x00, 0x72, 0x00, 0x61, 0x00, 0x77, 0x00, 0x63, 0x00, 0x68, 0x00,
            0x6b, 0x00, 0x70, 0x00, 0x61, 0x00, 0x74, 0x00, 0x68, 0x00, 0x78, 0x00, 0x78, 0x00, 0x5c, 0x00,
            0x66, 0x00, 0x6f, 0x00, 0x6f, 0x00, 0x00, 0x00
        },
        .size = 0x48,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x48 - SMB_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb_command = SMB_COM_CHECK_DIRECTORY,
            .status = SMB_STATUS_OK,
            .path = "\\rawchkpathxx\\foo",
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x38,
        },
    },

    {
        .name = "Trans2, Set Path Info, Directory creation, Request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x4a, 0x41, 0x64, 0x00, 0x4a, 0x00,
            0x0f, 0x1c, 0x00, 0x12, 0x00, 0x02, 0x00, 0xe8, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x1c, 0x00, 0x44, 0x00, 0x12, 0x00, 0x60, 0x00, 0x01, 0x00, 0x06, 0x00, 0x31,
            0x00, 0x00, 0x00, 0x00, 0x09, 0x02, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x00, 0x74, 0x00, 0x6d, 0x00,
            0x70, 0x00, 0x2f, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x32, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x10, 0x02, 0x00, 0x00, 0xed, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x02
        },
        .size = 0x72,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x72 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH | CIFS_LEVEL_OF_INTEREST,
            .flag_file = CIFS_FILE_CREATE | CIFS_FILE_DIRECTORY,
            .level_of_interest = SMB_POSIX_PATH_OPEN,
            .path = "/tmp/test2",
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_SET_PATH_INFORMATION,
            },
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .meta_write_bytes = 0x12,
            .ids.multiplex_id = 0x4a,
        },
    },

    {
        .name = "Trans2, Set Path Info, Directory deletion, Request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x2c, 0x51, 0x64, 0x00, 0xa6, 0x00,
            0x0f, 0x1a, 0x00, 0x02, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x1a, 0x00, 0x44, 0x00, 0x02, 0x00, 0x5e, 0x00, 0x01, 0x00, 0x06, 0x00, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x0a, 0x02, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x00, 0x74, 0x00, 0x6d, 0x00,
            0x70, 0x00, 0x2f, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x60,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x60 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH | CIFS_LEVEL_OF_INTEREST,
            .flag_file = CIFS_FILE_UNLINK,
            .level_of_interest = SMB_POSIX_PATH_UNLINK,
            .path = "/tmp/toto",
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_SET_PATH_INFORMATION,
            },
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .meta_write_bytes = 0x2,
            .ids.multiplex_id = 0xa6,
        },
    },

    {
        .name = "SMB_TRANS2_OPEN2 - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x7e, 0x01,
            0x0f, 0x5c, 0x00, 0x3a, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x5c, 0x00, 0x44, 0x00, 0x3a, 0x00, 0xa0, 0x00, 0x01, 0x00, 0x00, 0x00, 0x99,
            0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x5c, 0x00, 0x72, 0x00, 0x61, 0x00, 0x77, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00, 0x6e, 0x00,
            0x5c, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x72, 0x00, 0x74, 0x00, 0x75, 0x00, 0x72, 0x00, 0x65, 0x00,
            0x5f, 0x00, 0x74, 0x00, 0x32, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x5f, 0x00,
            0x79, 0x00, 0x65, 0x00, 0x73, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00,
            0x3a, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x0b, 0x00, 0x2e, 0x43, 0x4c, 0x41, 0x53, 0x53, 0x49, 0x4e,
            0x46, 0x4f, 0x00, 0x66, 0x69, 0x72, 0x73, 0x74, 0x20, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x00, 0x06,
            0x03, 0x00, 0x45, 0x41, 0x20, 0x54, 0x57, 0x4f, 0x00, 0x66, 0x6f, 0x6f, 0x00, 0x07, 0x02, 0x00,
            0x58, 0x20, 0x54, 0x48, 0x49, 0x52, 0x44, 0x00, 0x78, 0x79
        },
        .size = 0xda,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xda - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH,
            .path = "\\rawopen\\torture_t2open_yes.txt",
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_OPEN2,
            },
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_write_bytes = 0x96,
            .ids.multiplex_id = 0x017e,
        },
    },

    {
        .name = "SMB_TRANS2_OPEN2 - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x7e, 0x01,
            0x0a, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0x00, 0x3a, 0x0b, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x07, 0x00, 0x00, 0x00, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x58,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x58 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .set_values = CIFS_FID,
            .fid = 0x400b,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x1e,
            .ids.multiplex_id = 0x017e,
        },
    },

    {
        .name = "SMB_TRANS2_CREATE_DIRECTORY - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x17, 0x00,
            0x0f, 0x2e, 0x00, 0x04, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x2e, 0x00, 0x44, 0x00, 0x04, 0x00, 0x72, 0x00, 0x01, 0x00, 0x0d, 0x00, 0x35,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x6d, 0x00, 0x6b, 0x00, 0x64, 0x00,
            0x69, 0x00, 0x72, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x5c, 0x00, 0x6d, 0x00,
            0x6b, 0x00, 0x64, 0x00, 0x69, 0x00, 0x72, 0x00, 0x2e, 0x00, 0x64, 0x00, 0x69, 0x00, 0x72, 0x00,
            0x00, 0x00, 0x04, 0x00, 0x00, 0x00
        },
        .size = 0x76,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x76 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH,
            .path = "\\mkdirtest\\mkdir.dir",
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_CREATE_DIRECTORY,
            },
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_write_bytes = 0x4,
            .ids.multiplex_id = 0x17,
        },
    },

    {
        .name = "Com delete directory, Query",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xdb, 0x4f, 0x64, 0x00, 0x82, 0x00,
            0x00, 0x17, 0x00, 0x04, 0x2f, 0x00, 0x74, 0x00, 0x6d, 0x00, 0x70, 0x00, 0x2f, 0x00, 0x74, 0x00,
            0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x32, 0x00, 0x00, 0x00
        },
        .size = 0x3a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x3a - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_DELETE_DIRECTORY,
            .status = SMB_STATUS_OK,
            .set_values = CIFS_PATH,
            .path = "/tmp/test2",
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0x82,
        },
    },

    {
        .name = "Com delete, Query Path Info, inexistant file, Response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x34, 0x00, 0x00, 0xc0, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xa2, 0x5a, 0x64, 0x00, 0xec, 0x00,
            0x00, 0x00, 0x00
        },
        .size = 0x23,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x23 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OBJECT_NAME_NOT_FOUND,
            .version = SMB_VERSION_1,
            .tree_id = 0x01,
            .ids.multiplex_id = 0xec,
        },
    },

    {
        .name = "Create file with path - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa2, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x88, 0x68, 0x0b, 0x01, 0x38, 0x86, 0x08,
            0x18, 0xff, 0x00, 0xde, 0xde, 0x00, 0x54, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x80, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x07, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
            0x03, 0x57, 0x00, 0x00, 0x5c, 0x00, 0x54, 0x00, 0x4f, 0x00, 0x54, 0x00, 0x52, 0x00, 0x6f, 0x00,
            0x6f, 0x00, 0x74, 0x00, 0x52, 0x00, 0x5f, 0x00, 0x53, 0x00, 0x6d, 0x00, 0x55, 0x00, 0x72, 0x00,
            0x61, 0x00, 0x6e, 0x00, 0x69, 0x00, 0x70, 0x00, 0x5c, 0x00, 0x44, 0x00, 0x4e, 0x00, 0x42, 0x00,
            0x4f, 0x00, 0x58, 0x00, 0x5c, 0x00, 0x4e, 0x00, 0x5e, 0x00, 0x43, 0x00, 0x5c, 0x00, 0x5f, 0x00,
            0x52, 0x00, 0x45, 0x00, 0x53, 0x00, 0x55, 0x00, 0x4c, 0x00, 0x54, 0x00, 0x41, 0x00, 0x54, 0x00,
            0x2e, 0x00, 0x43, 0x00, 0x53, 0x00, 0x56, 0x00, 0x00, 0x00, 0x0a
        },
        .size = 0xaa,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xaa - SMB_HEADER_SIZE },
            .path = "\\TOTRootR_SmUranip\\DNBOX\\N^C\\_RESULTAT.CSV",
            .set_values = CIFS_PATH,
            .command.smb_command = SMB_COM_NT_CREATE_ANDX,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x880b,
            .meta_write_bytes = 0x87,
            .ids.multiplex_id = 0x0886,
        },
    },

    {
        .name = "Create file with path - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa2, 0x00, 0x00, 0x00, 0x00, 0x98, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x88, 0x68, 0x0b, 0x01, 0x38, 0x86, 0x08,
            0x2a, 0xff, 0x00, 0x87, 0x00, 0x00, 0x07, 0x80, 0x01, 0x00, 0x00, 0x00, 0x05, 0xa2, 0x9e, 0xbb,
            0x6a, 0x94, 0xcf, 0x01, 0xbe, 0x12, 0xe7, 0xe1, 0x6b, 0x94, 0xcf, 0x01, 0xc3, 0x39, 0xee, 0xe1,
            0x6b, 0x94, 0xcf, 0x01, 0xc3, 0x39, 0xee, 0xe1, 0x6b, 0x94, 0xcf, 0x01, 0x20, 0x00, 0x00, 0x00,
            0xd8, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd5, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x01, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x87,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x87 - SMB_HEADER_SIZE },
            .fid = 0x8007,
            .set_values = CIFS_FID,
            .command.smb_command = SMB_COM_NT_CREATE_ANDX,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x880b,
            .meta_read_bytes = 0x54,
            .ids.multiplex_id = 0x0886,
        },
    },

    {
        .name = "Trans2 Request, Query file info, file internal info",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x4a, 0x53,
            0x91, 0xd1, 0xdd, 0x2e, 0xad, 0xa0, 0x00, 0x00, 0x08, 0x08, 0x74, 0x0e, 0x02, 0xf0, 0x87, 0x0c,
//          Wc--  Tot param-  Total data  Max param-  max data--  MaxS  Rese
            0x0f, 0x04, 0x00, 0x00, 0x00, 0x02, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//                                                                                        SubCommand  Byte
            0x00, 0x00, 0x00, 0x04, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x07, 0x00, 0x07,
//          Count Padding---------  Fid-------  Level of i
            0x00, 0x00, 0x00, 0x00, 0x12, 0x80, 0xee, 0x03
        },
        .size = 0x48,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x48 - SMB_HEADER_SIZE },
            .fid = 0x8012,
            .set_values = CIFS_FID | CIFS_TRANS2_SUBCMD | CIFS_LEVEL_OF_INTEREST,
            .command.smb_command = SMB_COM_TRANSACTION2,
            .subcommand.trans2_subcmd = SMB_TRANS2_QUERY_FILE_INFORMATION,
            .level_of_interest = PASS_THROUGH_LEVEL_OF_INTEREST | FILE_INTERNAL_INFORMATION,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x808,
            .ids.multiplex_id = 0x0c87,
        },
    },

    {
        .name = "Trans2 Response, Query file info, file internal info",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x98, 0x07, 0xc8, 0x00, 0x00, 0x6f, 0xf1,
            0xe4, 0x63, 0xa3, 0x56, 0x6b, 0xc0, 0x00, 0x00, 0x08, 0x08, 0x74, 0x0e, 0x02, 0xf0, 0x87, 0x0c,
            0x0a, 0x02, 0x00, 0x08, 0x00, 0x00, 0x00, 0x02, 0x00, 0x38, 0x00, 0x00, 0x00, 0x08, 0x00, 0x3c,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2f, 0xcb, 0x17, 0x00,
            0x00, 0x00, 0x14, 0x00
        },
        .size = 0x44,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x44 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x0808,
            .meta_read_bytes = 0x8,
            .ids.multiplex_id = 0x0c87,
        },
    },

    {
        .name = "Trans2 Response, Query file info, File standard info",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x98, 0x07, 0xc8, 0x00, 0x00, 0x2c, 0xb0,
            0xb5, 0x06, 0xb1, 0x57, 0x78, 0xc8, 0x00, 0x00, 0x08, 0x08, 0x74, 0x0e, 0x02, 0xf0, 0xc7, 0x0c,
            0x0a, 0x02, 0x00, 0x18, 0x00, 0x00, 0x00, 0x02, 0x00, 0x38, 0x00, 0x00, 0x00, 0x18, 0x00, 0x3c,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x1d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
            0x00, 0x01, 0x00, 0x00
        },
        .size = 0x54,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x54 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_TRANSACTION2,
            .subcommand.trans2_subcmd = SMB_TRANS2_QUERY_FILE_INFORMATION,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x0808,
            .meta_read_bytes = 0x18,
            .ids.multiplex_id = 0x0cc7,
        },
    },

    {
        .name = "Get Referral - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x98, 0x35,
            0xd3, 0x41, 0x85, 0x12, 0x50, 0x39, 0x00, 0x00, 0x06, 0x10, 0x68, 0x05, 0x01, 0x20, 0xc0, 0x00,
            0x0f, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x24, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x10, 0x00, 0x27,
            0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x61, 0x00, 0x62, 0x00, 0x63, 0x00, 0x64, 0x00, 0x74, 0x00,
            0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x69, 0x00, 0x6e, 0x00, 0x67, 0x00, 0x74, 0x00, 0x2e, 0x00,
            0x63, 0x00, 0x6f, 0x00, 0x6d, 0x00, 0x00, 0x00
        },
        .size = 0x68,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x68 - SMB_HEADER_SIZE },
            .path = "abcdtestingt.com",
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH,
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x1006,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_GET_DFS_REFERRAL,
            },
            .ids.multiplex_id = 0xc0,
        },
    },

    {
        .name = "Find Next2 - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x32, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x98, 0xcb,
            0x55, 0x0a, 0x44, 0xda, 0xc2, 0xba, 0x00, 0x00, 0x07, 0x00, 0x34, 0x10, 0x02, 0xe8, 0x44, 0xe2,
            0x0f, 0x3e, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x3e, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x02, 0x00, 0x41,
            0x00, 0x00, 0x00, 0x00, 0x05, 0x18, 0x56, 0x05, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00,
            0x41, 0x00, 0x44, 0x00, 0x5f, 0x00, 0x31, 0x00, 0x33, 0x00, 0x54, 0x00, 0x46, 0x00, 0x31, 0x00,
            0x32, 0x00, 0x43, 0x00, 0x5f, 0x00, 0x50, 0x00, 0x52, 0x00, 0x54, 0x00, 0x32, 0x00, 0x32, 0x00,
            0x32, 0x00, 0x46, 0x00, 0x46, 0x00, 0x46, 0x00, 0x2e, 0x00, 0x54, 0x00, 0x58, 0x00, 0x54, 0x00,
            0x00, 0x00
        },
        .size = 0x82,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x82 - SMB_HEADER_SIZE },
            .path = "AD_13TF12C_PRT222FFF.TXT",
            .set_values = CIFS_TRANS2_SUBCMD | CIFS_PATH,
            .command.smb_command = SMB_COM_TRANSACTION2,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x7,
            .subcommand = {
                .trans2_subcmd = SMB_TRANS2_FIND_NEXT2,
            },
            .ids.multiplex_id = 0xe244,
        },
    },

    {
        .name = "Flush - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x05, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0xff, 0xfe, 0x01, 0x38, 0x00, 0xaa,
            0x01, 0x0f, 0x00, 0x00, 0x00
        },
        .size = 0x25,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x25 - SMB_HEADER_SIZE },
            .fid = 0x000f,
            .set_values = CIFS_FID,
            .command.smb_command = SMB_COM_FLUSH,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x2007,
            .ids.multiplex_id = 0xaa00,
        },
    },

    {
        .name = "Rename - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x07, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0xd0, 0xff, 0xfe, 0x03, 0x48, 0x00, 0x94,
            0x01, 0x16, 0x00, 0xe3, 0x00, 0x04, 0x5c, 0x00, 0x61, 0x00, 0x61, 0x00, 0x61, 0x00, 0x61, 0x00,
            0x61, 0x00, 0x61, 0x00, 0x49, 0x00, 0x53, 0x00, 0x44, 0x00, 0x49, 0x00, 0x52, 0x00, 0x5f, 0x00,
            0x54, 0x00, 0x5c, 0x00, 0x4c, 0x00, 0x65, 0x00, 0x44, 0x00, 0x49, 0x00, 0x52, 0x00, 0x75, 0x00,
            0x5c, 0x00, 0x2e, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00,
            0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x33, 0x00, 0x30, 0x00, 0x5c, 0x00, 0x54, 0x00, 0x6d, 0x00,
            0x70, 0x00, 0x44, 0x00, 0x61, 0x00, 0x74, 0x00, 0x61, 0x00, 0x5c, 0x00, 0x31, 0x00, 0x31, 0x00,
            0x31, 0x00, 0x31, 0x00, 0x31, 0x00, 0x31, 0x00, 0x39, 0x00, 0x39, 0x00, 0x2e, 0x00, 0x74, 0x00,
            0x78, 0x00, 0x74, 0x00, 0x00, 0x00, 0x04, 0x00, 0x5c, 0x00, 0x46, 0x00, 0x6f, 0x00, 0x72, 0x00,
            0x6d, 0x00, 0x49, 0x00, 0x52, 0x00, 0x49, 0x00, 0x53, 0x00, 0x49, 0x00, 0x44, 0x00, 0x53, 0x00,
            0x5f, 0x00, 0x54, 0x00, 0x5c, 0x00, 0x4c, 0x00, 0x65, 0x00, 0x63, 0x00, 0x74, 0x00, 0x65, 0x00,
            0x75, 0x00, 0x72, 0x00, 0x2e, 0x00, 0x30, 0x00, 0x32, 0x00, 0x5c, 0x00, 0x32, 0x00, 0x30, 0x00,
            0x31, 0x00, 0x34, 0x00, 0x30, 0x00, 0x36, 0x00, 0x33, 0x00, 0x30, 0x00, 0x5c, 0x00, 0x44, 0x00,
            0x61, 0x00, 0x74, 0x00, 0x61, 0x00, 0x5c, 0x00, 0x30, 0x00, 0x31, 0x00, 0x5c, 0x00, 0x30, 0x00,
            0x31, 0x00, 0x30, 0x00, 0x30, 0x00, 0x30, 0x00, 0x38, 0x00, 0x39, 0x00, 0x39, 0x00, 0x2e, 0x00,
            0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00
        },
        .size = 0x108,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x108 - SMB_HEADER_SIZE },
            .path = "\\aaaaaaISDIR_T\\LeDIRu\\.00000000030\\TmpData\\11111199.txt",
            .set_values = CIFS_PATH,
            .command.smb_command = SMB_COM_RENAME,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0xd004,
            .ids.multiplex_id = 0x9400,
        },
    },

    {
        .name = "Locking AndX - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x24, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0xff, 0xfe, 0x01, 0x90, 0x0d, 0x14,
            0x08, 0xff, 0x00, 0xde, 0xde, 0x7e, 0x40, 0x10, 0x00, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00,
            0x00, 0x14, 0x00, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x59, 0xff, 0xff, 0x7f, 0x00,
            0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00
        },
        .size = 0x47,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x47 - SMB_HEADER_SIZE },
            .fid = 0x407e,
            .set_values = CIFS_FID,
            .command.smb_command = SMB_COM_LOCKING_ANDX,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x7800,
            .ids.multiplex_id = 0x140d,
        },
    },

    {
        .name = "NT Transact (SMB_NT_TRANSACT_NOTIFY_CHANGE) -  request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x70, 0x0e, 0x01, 0x90, 0x48, 0x78,
            0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x04, 0x04, 0x00, 0x03, 0x00, 0x00, 0x00, 0xd7, 0x80, 0x01, 0x00, 0x03,
            0x00, 0x00, 0x00, 0x00
        },
        .size = 0x54,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x54 - SMB_HEADER_SIZE },
            .fid = 0x80d7,
            .set_values = CIFS_NT_TRANSACT_SUBCMD | CIFS_FID,
            .command.smb_command = SMB_COM_NT_TRANSACT,
            .subcommand = {
                .nt_transact_subcmd = SMB_NT_TRANSACT_NOTIFY_CHANGE,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x7800,
            .ids.multiplex_id = 0x7848,
        },
    },

    {
        .name = "NT Transact (SMB_NT_TRANSACT_IOCTL) -  request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0x94, 0x04, 0x01, 0x38, 0x40, 0x51,
            0x17, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x54, 0x00, 0x00, 0x00, 0x04, 0x02, 0x00, 0xc0, 0x00, 0x09, 0x00, 0x10, 0x80, 0x01, 0x00, 0x03,
            0x00, 0x00, 0x00, 0x00
   },
        .size = 0x54,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x54 - SMB_HEADER_SIZE },
            .fid = 0x8010,
            .set_values = CIFS_NT_TRANSACT_SUBCMD | CIFS_FID,
            .command.smb_command = SMB_COM_NT_TRANSACT,
            .subcommand = {
                .nt_transact_subcmd = SMB_NT_TRANSACT_IOCTL,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x2007,
            .ids.multiplex_id = 0x5140,
        },
    },

    {
        .name = "NT Transact (SMB_NT_TRANSACT_QUERY_SECURITY_DESC) -  request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x20, 0x94, 0x04, 0x01, 0x38, 0x80, 0xf2,
            0x13, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
            0x00, 0x10, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x54, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x40, 0x00, 0x00,
            0x07, 0x00, 0x00, 0x00
   },
        .size = 0x54,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x54 - SMB_HEADER_SIZE },
            .fid = 0x400e,
            .set_values = CIFS_NT_TRANSACT_SUBCMD | CIFS_FID,
            .command.smb_command = SMB_COM_NT_TRANSACT,
            .subcommand = {
                .nt_transact_subcmd = SMB_NT_TRANSACT_QUERY_SECURITY_DESC,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x2007,
            .ids.multiplex_id = 0xf280,
        },
    },

    {
        .name = "NT Transact (SMB_NT_TRANSACT_CREATE) -  request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x3d, 0x01,
            0x13, 0x00, 0x00, 0x00, 0x74, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x65, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x74, 0x00, 0x00, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xc0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x77, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0xff, 0x01, 0x1f, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x5c, 0x00, 0x72, 0x00, 0x61, 0x00, 0x77, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00,
            0x6e, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x72, 0x00, 0x74, 0x00, 0x75, 0x00, 0x72, 0x00,
            0x65, 0x00, 0x5f, 0x00, 0x6e, 0x00, 0x74, 0x00, 0x63, 0x00, 0x72, 0x00, 0x65, 0x00, 0x61, 0x00,
            0x74, 0x00, 0x65, 0x00, 0x78, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00
   },
        .size = 0xc0,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xc0 - SMB_HEADER_SIZE },
            .set_values = CIFS_NT_TRANSACT_SUBCMD | CIFS_PATH,
            .path = "\\rawopen\\torture_ntcreatex.txt",
            .command.smb_command = SMB_COM_NT_TRANSACT,
            .subcommand = {
                .nt_transact_subcmd = SMB_NT_TRANSACT_CREATE,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x0800,
            .ids.multiplex_id = 0x013d,
        },
    },


    {
        .name = "Transaction (SMB_TRANS_WAIT_NMPIPE) -  request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x25, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x90, 0x68, 0x0b, 0x01, 0x38, 0x01, 0x14,
            0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x53, 0x00, 0x00,
            0x00, 0x21, 0x00, 0x00, 0x5c, 0x00, 0x50, 0x00, 0x49, 0x00, 0x50, 0x00, 0x45, 0x00, 0x5c, 0x00,
            0x4d, 0x00, 0x73, 0x00, 0x46, 0x00, 0x74, 0x00, 0x65, 0x00, 0x57, 0x00, 0x64, 0x00, 0x73, 0x00,
            0x00, 0x00, 0x00, 0x00
   },
        .size = 0x64,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x64 - SMB_HEADER_SIZE },
            .path = "\\PIPE\\MsFteWds",
            .set_values = CIFS_TRANSACTION_SUBCMD | CIFS_PATH,
            .command.smb_command = SMB_COM_TRANSACTION,
            .subcommand = {
                .transaction_subcmd = SMB_TRANS_WAIT_NMPIPE,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x9008,
            .ids.multiplex_id = 0x1401,
        },
    },

    {
        .name = "Transaction (SMB_TRANS_TRANSACT_NMPIPE) -  request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x25, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x42, 0x31,
            0x9f, 0xa2, 0xd7, 0x94, 0x7f, 0x58, 0x00, 0x00, 0x00, 0x08, 0x30, 0x16, 0x00, 0x08, 0x80, 0x1d,
            0x10, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x00, 0x60, 0x00, 0x54, 0x00, 0x02, 0x00, 0x26, 0x00, 0x00,
            0x80, 0x71, 0x00, 0x00, 0x5c, 0x00, 0x50, 0x00, 0x49, 0x00, 0x50, 0x00, 0x45, 0x00, 0x5c, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x03, 0x10, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00,
            0x02, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x02, 0x00,
            0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x4b, 0x00, 0x41, 0x00,
            0x54, 0x00, 0x41, 0x00, 0x41, 0x00, 0x4e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x04, 0x00, 0x02, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x08, 0x00, 0x02, 0x00,
            0x00, 0x00, 0x00, 0x00
   },
        .size = 0xb4,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xb4 - SMB_HEADER_SIZE },
            .fid = 0x8000,
            .set_values = CIFS_TRANSACTION_SUBCMD | CIFS_FID,
            .command.smb_command = SMB_COM_TRANSACTION,
            .subcommand = {
                .transaction_subcmd = SMB_TRANS_TRANSACT_NMPIPE,
            },
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .tree_id = 0x0800,
            .query_write_bytes = 0x60,
            .ids.multiplex_id = 0x1d80,
        },
    },

    {
        .name = "Session setup AndX response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x73, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0xc0, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x17, 0x64, 0x00, 0x02, 0x00,
            0x03, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x55, 0x00, 0x6e, 0x00, 0x69, 0x00,
            0x78, 0x00, 0x00, 0x00, 0x53, 0x00, 0x61, 0x00, 0x6d, 0x00, 0x62, 0x00, 0x61, 0x00, 0x20, 0x00,
            0x33, 0x00, 0x2e, 0x00, 0x35, 0x00, 0x2e, 0x00, 0x36, 0x00, 0x00, 0x00, 0x57, 0x00, 0x4f, 0x00,
            0x52, 0x00, 0x4b, 0x00, 0x47, 0x00, 0x52, 0x00, 0x4f, 0x00, 0x55, 0x00, 0x50, 0x00, 0x00, 0x00
        },
        .size = 0x60,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x60 - SMB_HEADER_SIZE },
            .set_values = CIFS_DOMAIN | CIFS_SERVER_OS,
            .command.smb_command = SMB_COM_SESSION_SETUP_ANDX,
            .os = "Unix",
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_1,
            .domain = "WORKGROUP",
            .ids.multiplex_id = 0x02,
        },
    },

    {
        .name = "SMB_COM_OPEN_ANDX request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2d, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x2c, 0x00,
            0x0f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x42, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2f,
            0x00, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x73, 0x00, 0x65, 0x00,
            0x61, 0x00, 0x72, 0x00, 0x63, 0x00, 0x68, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x30, 0x00, 0x30, 0x00,
            0x30, 0x00, 0x2d, 0x00, 0x30, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00
        },
        .size = 0x70,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x70 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_OPEN_ANDX,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\testsearch\\t000-0.txt",
            .tree_id = 0x800,
            .meta_write_bytes = 0x4d,
            .ids.multiplex_id = 0x2c,
        }
    },

    {
        .name = "SMB_COM_OPEN_ANDX response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2d, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x2c, 0x00,
            0x0f, 0xff, 0x00, 0x41, 0x00, 0x01, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00
        },
        .size = 0x41,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x41 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_OPEN_ANDX,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4001,
            .tree_id = 0x800,
            .meta_read_bytes = 0x1e,
            .ids.multiplex_id = 0x2c,
        }
    },

    {
        .name = "SMB_COM_OPEN - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x02, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x14, 0x00,
            0x02, 0xff, 0x00, 0x00, 0x00, 0x35, 0x00, 0x04, 0x5c, 0x00, 0x61, 0x00, 0x62, 0x00, 0x63, 0x00,
            0x6f, 0x00, 0x70, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x5c, 0x00, 0x61, 0x00, 0x62, 0x00, 0x63, 0x00,
            0x64, 0x00, 0x65, 0x00, 0x66, 0x00, 0x67, 0x00, 0x5f, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00,
            0x6e, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00
        },
        .size = 0x5c,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x5c - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_OPEN,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\abcopen\\abcdefg_open.txt",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x14,
        }
    },

    {
        .name = "SMB_COM_OPEN - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x02, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x1d, 0x00,
            0x07, 0x03, 0x40, 0x20, 0x00, 0x6e, 0xde, 0xf5, 0x43, 0x07, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00,
            0x00
        },
        .size = 0x31,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x31 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_OPEN,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4003,
            .tree_id = 0x800,
            .meta_read_bytes = 0xe,
            .ids.multiplex_id = 0x1d,
        }
    },

    {
        .name = "SMB_COM_QUERY_INFORMATION - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x08, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0b, 0x00,
            0x00, 0x2f, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00, 0x6d, 0x00, 0x70, 0x00, 0x74, 0x00, 0x6d, 0x00,
            0x70, 0x00, 0x72, 0x00, 0x5f, 0x00, 0x5f, 0x00, 0x66, 0x00, 0x69, 0x00, 0x6c, 0x00, 0x65, 0x00,
            0x69, 0x00, 0x6e, 0x00, 0x66, 0x00, 0x6f, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00,
            0x00, 0x00
        },
        .size = 0x52,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x52 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_QUERY_INFORMATION,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\tmptmpr__fileinfo.txt",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0b,
        }
    },

    {
        .name = "SMB_COM_QUERY_INFORMATION - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x08, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0b, 0x00,
            0x0a, 0x20, 0x00, 0x5e, 0xde, 0xf5, 0x43, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x37,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x37 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_QUERY_INFORMATION,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x14,
            .ids.multiplex_id = 0x0b,
        }
    },

    {
        .name = "SMB_COM_SET_INFORMATION - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x09, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x19, 0x00,
            0x08, 0x01, 0x00, 0xde, 0xe5, 0x7d, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x47, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x73, 0x00,
            0x66, 0x00, 0x69, 0x00, 0x6c, 0x00, 0x65, 0x00, 0x69, 0x00, 0x6e, 0x00, 0x66, 0x00, 0x6f, 0x00,
            0x5c, 0x00, 0x66, 0x00, 0x69, 0x00, 0x6c, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x61, 0x00, 0x6d, 0x00,
            0x65, 0x00, 0x5f, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x2e, 0x00, 0x74, 0x00,
            0x78, 0x00, 0x74, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00
        },
        .size = 0x7a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x7a - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SET_INFORMATION,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\testsfileinfo\\filename_test.txt",
            .tree_id = 0x800,
            .meta_write_bytes = 0x10,
            .ids.multiplex_id = 0x19,
        }
    },

    {
        .name = "SMB_COM_CREATE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x03, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xb2, 0x01,
            0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x39, 0x00, 0x04, 0x5c, 0x00, 0x72, 0x00, 0x61, 0x00,
            0x77, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x6f, 0x00,
            0x72, 0x00, 0x74, 0x00, 0x75, 0x00, 0x72, 0x00, 0x65, 0x00, 0x5f, 0x00, 0x63, 0x00, 0x72, 0x00,
            0x65, 0x00, 0x61, 0x00, 0x74, 0x00, 0x65, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00,
            0x00, 0x00
        },
        .size = 0x62,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x62 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CREATE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\rawopen\\torture_create.txt",
            .tree_id = 0x800,
            .meta_write_bytes = 0x6,
            .ids.multiplex_id = 0x01b2,
        }
    },

    {
        .name = "SMB_COM_CREATE - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x03, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xb2, 0x01,
            0x01, 0x09, 0x80, 0x00, 0x00
        },
        .size = 0x25,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x25 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CREATE,
            .set_values = CIFS_FID,
            .version = SMB_VERSION_1,
            .fid = 0x8009,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x01b2,
        }
    },

    {
        .name = "SMB_COM_LOCK_BYTE_RANGE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x33, 0x00,
            0x05, 0x01, 0x40, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x2d,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2d - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_LOCK_BYTE_RANGE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4001,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x33,
        }
    },

    {
        .name = "SMB_COM_UNLOCK_BYTE_RANGE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x35, 0x00,
            0x05, 0x01, 0x40, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x2d,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2d - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_UNLOCK_BYTE_RANGE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4001,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x35,
        }
    },

    {
        .name = "SMB_COM_CREATE_TEMPORARY - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xbf, 0x01,
            0x03, 0x02, 0x00, 0xf2, 0x2b, 0x83, 0x43, 0x13, 0x00, 0x04, 0x5c, 0x00, 0x72, 0x00, 0x61, 0x00,
            0x77, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x00, 0x00
        },
        .size = 0x3c,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x3c - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CREATE_TEMPORARY,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\rawopen",
            .tree_id = 0x800,
            .meta_write_bytes = 0x6,
            .ids.multiplex_id = 0x01bf,
        }
    },

    {
        .name = "SMB_COM_CREATE_TEMPORARY - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xbf, 0x01,
            0x01, 0x0d, 0x80, 0x09, 0x00, 0x53, 0x52, 0x56, 0x42, 0x39, 0x44, 0x38, 0x32, 0x00
        },
        .size = 0x2e,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2e - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CREATE_TEMPORARY,
            .set_values = CIFS_FID | CIFS_PATH,
            .version = SMB_VERSION_1,
            .fid = 0x800d,
            .path = "SRVB9D82",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x01bf,
        }
    },

    {
        .name = "SMB_COM_CREATE_NEW - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xa7, 0x01,
            0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x00, 0x04, 0x5c, 0x00, 0x72, 0x00, 0x61, 0x00,
            0x77, 0x00, 0x6f, 0x00, 0x70, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00,
            0x73, 0x00, 0x74, 0x00, 0x74, 0x00, 0x6d, 0x00, 0x70, 0x00, 0x5f, 0x00, 0x6d, 0x00, 0x6b, 0x00,
            0x6e, 0x00, 0x65, 0x00, 0x77, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00
        },
        .size = 0x60,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x60 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CREATE_NEW,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\rawopen\\testtmp_mknew.txt",
            .tree_id = 0x800,
            .meta_write_bytes = 0x6,
            .ids.multiplex_id = 0x01a7,
        }
    },

    {
        .name = "SMB_COM_CREATE_NEW - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xa6, 0x01,
            0x01, 0x06, 0x80, 0x00, 0x00
        },
        .size = 0x25,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x25 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CREATE_NEW,
            .set_values = CIFS_FID,
            .version = SMB_VERSION_1,
            .fid = 0x8006,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x01a6,
        }
    },

    {
        .name = "SMB_COM_SEEK - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x12, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xfa, 0x7a, 0x00, 0x08, 0x0a, 0x00,
            0x04, 0x00, 0x40, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x2b,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2b - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SEEK,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4000,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0a,
        }
    },

    {
        .name = "SMB_COM_SEEK - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x12, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xfa, 0x7a, 0x00, 0x08, 0x0a, 0x00,
            0x02, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x27,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x27 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SEEK,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x4,
            .ids.multiplex_id = 0x0a,
        }
    },

    {
        .name = "SMB_COM_LOCK_AND_READ - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x13, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x69, 0x00,
            0x05, 0x02, 0x40, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x2d,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x2d - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_LOCK_AND_READ,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4002,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x69,
        }
    },

    {
        .name = "SMB_COM_LOCK_AND_READ - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x13, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x69, 0x00,
            0x05, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x01, 0x09, 0x00,
            0x54, 0x45, 0x53, 0x54, 0x20, 0x44, 0x41, 0x54, 0x41
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_LOCK_AND_READ,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .response_read_bytes = 0x9,
            .ids.multiplex_id = 0x69,
        }
    },

    {
        .name = "SMB_COM_WRITE_AND_UNLOCK - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x14, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x21, 0x00,
            0x05, 0x01, 0x40, 0x09, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x01, 0x09, 0x00,
            0x25, 0x3c, 0xd8, 0x5d, 0x54, 0x63, 0x79, 0xae, 0x53
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE_AND_UNLOCK,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4001,
            .tree_id = 0x800,
            .query_write_bytes = 0x9,
            .ids.multiplex_id = 0x21,
        }
    },

    {
        .name = "SMB_COM_WRITE_AND_UNLOCK - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x14, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x21, 0x00,
            0x01, 0x09, 0x00, 0x00, 0x00
        },
        .size = 0x25,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x25 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE_AND_UNLOCK,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .response_write_bytes = 0x9,
            .ids.multiplex_id = 0x21,
        }
    },

    {
        .name = "SMB_COM_READ_RAW - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x92, 0x00,
            0x0a, 0x03, 0x40, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x37,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x37 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_READ_RAW,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4003,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x92,
        }
    },

    {
        .name = "SMB_COM_SET_INFORMATION2 - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x22, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xfa, 0x7a, 0x00, 0x08, 0x26, 0x00,
            0x07, 0x02, 0x40, 0x10, 0x35, 0xd2, 0x74, 0xb2, 0x34, 0xd2, 0x74, 0x51, 0x34, 0xd2, 0x74, 0x00,
            0x00
        },
        .size = 0x31,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x31 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SET_INFORMATION2,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4002,
            .tree_id = 0x800,
            .meta_write_bytes = 0xe,
            .ids.multiplex_id = 0x26,
        }
    },

    {
        .name = "SMB_COM_QUERY_INFORMATION2 - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x23, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0a, 0x00,
            0x01, 0x00, 0x40, 0x00, 0x00
        },
        .size = 0x25,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x25 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_QUERY_INFORMATION2,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4000,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0a,
        }
    },

    {
        .name = "SMB_COM_QUERY_INFORMATION2 - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x23, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0a, 0x00,
            0x0b, 0x10, 0x35, 0xfd, 0x73, 0xb2, 0x34, 0xfd, 0x73, 0x51, 0x34, 0xfd, 0x73, 0x07, 0x00, 0x00,
            0x00, 0x08, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_QUERY_INFORMATION2,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x16,
            .ids.multiplex_id = 0x0a,
        }
    },

    {
        .name = "SMB_COM_WRITE_AND_CLOSE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2c, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x39, 0x00,
            0x06, 0x02, 0x40, 0x09, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00,
            0x25, 0x3c, 0xd8, 0x5d, 0x54, 0x63, 0x79, 0xae, 0x53
        },
        .size = 0x39,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x39 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE_AND_CLOSE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4002,
            .tree_id = 0x800,
            .query_write_bytes = 0x9,
            .ids.multiplex_id = 0x39,
        }
    },

    {
        .name = "SMB_COM_WRITE_AND_CLOSE - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x2c, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1e, 0x7a, 0x00, 0x08, 0x39, 0x00,
            0x01, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x28,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x28 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_WRITE_AND_CLOSE,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .response_write_bytes = 0x9,
            .ids.multiplex_id = 0x39,
        }
    },

    {
        .name = "SMB_COM_SEARCH - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x81, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xa4, 0x05,
            0x02, 0x64, 0x00, 0x00, 0x00, 0x24, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00,
            0x74, 0x00, 0x73, 0x00, 0x65, 0x00, 0x61, 0x00, 0x72, 0x00, 0x63, 0x00, 0x68, 0x00, 0x5c, 0x00,
            0x2a, 0x00, 0x2e, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00
        },
        .size = 0x4b,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x4b - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SEARCH,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\testsearch\\*.*",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x05a4,
        }
    },

    {
        .name = "SMB_COM_SEARCH - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x81, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0x48, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0xa4, 0x05,
            0x01, 0x0a, 0x00, 0xb1, 0x01, 0x05, 0xae, 0x01, 0x18, 0x2a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
            0x20, 0x2a, 0x20, 0x20, 0x04, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0x74,
            0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30, 0x30, 0x30, 0x2d, 0x30, 0x2e, 0x74, 0x78, 0x74,
            0x00, 0x20, 0x20, 0x18, 0x2a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2a, 0x20, 0x20, 0x04,
            0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0x74, 0x73, 0x33, 0x00, 0x00, 0x00,
            0x00, 0x74, 0x30, 0x30, 0x31, 0x2d, 0x31, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x20, 0x20, 0x18, 0x2a,
            0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2a, 0x20, 0x20, 0x04, 0x02, 0x00, 0x01, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x20, 0x01, 0x74, 0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30, 0x30, 0x32,
            0x2d, 0x32, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x20, 0x20, 0x18, 0x2a, 0x20, 0x20, 0x20, 0x20, 0x20,
            0x20, 0x20, 0x2a, 0x20, 0x20, 0x04, 0x03, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01,
            0x74, 0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30, 0x30, 0x33, 0x2d, 0x33, 0x2e, 0x74, 0x78,
            0x74, 0x00, 0x20, 0x20, 0x18, 0x2a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2a, 0x20, 0x20,
            0x04, 0x04, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0x74, 0x73, 0x33, 0x00, 0x00,
            0x00, 0x00, 0x74, 0x30, 0x30, 0x34, 0x2d, 0x34, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x20, 0x20, 0x18,
            0x2a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2a, 0x20, 0x20, 0x04, 0x05, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0x74, 0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30, 0x30,
            0x35, 0x2d, 0x35, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x20, 0x20, 0x18, 0x2a, 0x20, 0x20, 0x20, 0x20,
            0x20, 0x20, 0x20, 0x2a, 0x20, 0x20, 0x04, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20,
            0x01, 0x74, 0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30, 0x30, 0x36, 0x2d, 0x36, 0x2e, 0x74,
            0x78, 0x74, 0x00, 0x20, 0x20, 0x18, 0x2a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2a, 0x20,
            0x20, 0x04, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0x74, 0x73, 0x33, 0x00,
            0x00, 0x00, 0x00, 0x74, 0x30, 0x30, 0x37, 0x2d, 0x37, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x20, 0x20,
            0x18, 0x2a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x2a, 0x20, 0x20, 0x04, 0x08, 0x00, 0x01,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x01, 0x74, 0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30,
            0x30, 0x38, 0x2d, 0x38, 0x2e, 0x74, 0x78, 0x74, 0x00, 0x20, 0x20, 0x18, 0x2a, 0x20, 0x20, 0x20,
            0x20, 0x20, 0x20, 0x20, 0x2a, 0x20, 0x20, 0x04, 0x09, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x20, 0x01, 0x74, 0x73, 0x33, 0x00, 0x00, 0x00, 0x00, 0x74, 0x30, 0x30, 0x39, 0x2d, 0x39, 0x2e,
            0x74, 0x78, 0x74, 0x00, 0x20, 0x20
        },
        .size = 0x1d6,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x1d6 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_SEARCH,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x1ae,
            .ids.multiplex_id = 0x05a4,
        }
    },

    {
        .name = "SMB_COM_FIND - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x82, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0b, 0x00,
            0x02, 0x01, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00, 0x6d, 0x00, 0x70, 0x00,
            0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x5f, 0x00, 0x73, 0x00, 0x65, 0x00, 0x61, 0x00,
            0x72, 0x00, 0x63, 0x00, 0x68, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00,
            0x05, 0x00, 0x00
        },
        .size = 0x53,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x53 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_FIND,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\tmptest_search.txt",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0b,
        }
    },

    {
        .name = "SMB_COM_FIND - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x82, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0x48, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0b, 0x00,
            0x01, 0x01, 0x00, 0x2e, 0x00, 0x05, 0x2b, 0x00, 0x08, 0x54, 0x4f, 0x52, 0x54, 0x55, 0x52, 0x7e,
            0x31, 0x54, 0x58, 0x54, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x74,
            0x51, 0x34, 0x07, 0x00, 0x00, 0x00, 0x54, 0x4f, 0x52, 0x54, 0x55, 0x52, 0x7e, 0x31, 0x2e, 0x54,
            0x58, 0x54, 0x00
        },
        .size = 0x53,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x53 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_FIND,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x2b,
            .ids.multiplex_id = 0x0b,
        }
    },

    {
        .name = "SMB_COM_FIND_UNIQUE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x83, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0e, 0x00,
            0x02, 0x01, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00, 0x6d, 0x00, 0x70, 0x00,
            0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x5f, 0x00, 0x73, 0x00, 0x65, 0x00, 0x61, 0x00,
            0x72, 0x00, 0x63, 0x00, 0x68, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00,
            0x05, 0x00, 0x00
        },
        .size = 0x53,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x53 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_FIND_UNIQUE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\tmptest_search.txt",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0e,
        }
    },

    {
        .name = "SMB_COM_FIND_UNIQUE - response",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x83, 0x00, 0x00, 0x00, 0x00, 0x88, 0x03, 0x48, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0e, 0x00,
            0x01, 0x01, 0x00, 0x2e, 0x00, 0x05, 0x2b, 0x00, 0xff, 0x54, 0x4f, 0x52, 0x54, 0x55, 0x52, 0x7e,
            0x31, 0x54, 0x58, 0x54, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x74,
            0x51, 0x34, 0x07, 0x00, 0x00, 0x00, 0x54, 0x4f, 0x52, 0x54, 0x55, 0x52, 0x7e, 0x31, 0x2e, 0x54,
            0x58, 0x54, 0x00
        },
        .size = 0x53,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x53 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_FIND_UNIQUE,
            .version = SMB_VERSION_1,
            .tree_id = 0x800,
            .meta_read_bytes = 0x2b,
            .ids.multiplex_id = 0x0e,
        }
    },

    {
        .name = "SMB_COM_FIND_CLOSE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0x84, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x0c, 0x00,
            0x02, 0x01, 0x00, 0x00, 0x00, 0x1b, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00, 0x6d, 0x00, 0x70, 0x00,
            0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x5f, 0x00, 0x73, 0x00, 0x65, 0x00, 0x61, 0x00,
            0x72, 0x00, 0x63, 0x00, 0x68, 0x00, 0x2e, 0x00, 0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00,
            0x05, 0x00, 0x00
        },
        .size = 0x53,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x53 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_FIND_CLOSE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\tmptest_search.txt",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x0c,
        }
    },

    {
        .name = "SMB_COM_NT_RENAME - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa5, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xfa, 0x7a, 0x00, 0x08, 0x2a, 0x00,
            0x04, 0x00, 0x00, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5b, 0x00, 0x04, 0x5c, 0x00, 0x74, 0x00,
            0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x72, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x61, 0x00, 0x6d, 0x00,
            0x65, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x31, 0x00, 0x2e, 0x00,
            0x74, 0x00, 0x78, 0x00, 0x74, 0x00, 0x00, 0x00, 0x04, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00,
            0x73, 0x00, 0x74, 0x00, 0x72, 0x00, 0x65, 0x00, 0x6e, 0x00, 0x61, 0x00, 0x6d, 0x00, 0x65, 0x00,
            0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00, 0x32, 0x00, 0x2e, 0x00, 0x74, 0x00,
            0x78, 0x00, 0x74, 0x00, 0x00, 0x00
        },
        .size = 0x86,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x86 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_NT_RENAME,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\testrename\\test1.txt",
            .tree_id = 0x800,
            .ids.multiplex_id = 0x2a,
        }
    },

    {
        .name = "SMB_COM_CLOSE_PRINT_FILE - request",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xc2, 0x00, 0x00, 0x00, 0x00, 0x08, 0x03, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x43, 0x79, 0x00, 0x08, 0x1e, 0x00,
            0x01, 0x02, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x29,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0x29 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_CLOSE_PRINT_FILE,
            .version = SMB_VERSION_1,
            .set_values = CIFS_FID,
            .fid = 0x4002,
            .tree_id = 0x800,
            .ids.multiplex_id = 0x1e,
        }
    },

    {
        .name = "SMB_COM_NT_CREATE_ANDX - request (chained smb commands)",
        .packet = (uint8_t const []) {
            0xff, 0x53, 0x4d, 0x42, 0xa2, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x88, 0x68, 0x0b, 0x01, 0x38, 0x47, 0xcf,
            0x18, 0xff, 0x00, 0xde, 0xde, 0x00, 0x36, 0x00, 0x16, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x07, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
            0x03, 0x39, 0x00, 0x00, 0x5c, 0x00, 0x41, 0x00, 0x42, 0x00, 0x43, 0x00, 0x44, 0x00, 0x45, 0x00,
            0x46, 0x00, 0x47, 0x00, 0x5c, 0x00, 0x48, 0x00, 0x49, 0x00, 0x50, 0x00, 0x51, 0x00, 0x52, 0x00,
            0x53, 0x00, 0x54, 0x00, 0x55, 0x00, 0x56, 0x00, 0x57, 0x00, 0x58, 0x00, 0x59, 0x00, 0x60, 0x00,
            0x4f, 0x00, 0x58, 0x00, 0x5c, 0x00, 0x56, 0x00, 0x4e, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x29, 0xff, 0x53, 0x4d, 0x42, 0x04, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x88, 0xff, 0xfe,
            0x01, 0x38, 0x8d, 0xcf, 0x03, 0x05, 0xc0, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00,
            0xff, 0x53, 0x4d, 0x42, 0x04, 0x00, 0x00, 0x00, 0x00, 0x18, 0x07, 0xc8, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x88, 0xff, 0xfe, 0x01, 0x38, 0x8d, 0xcf,
            0x03, 0x05, 0xc0, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00
        },
        .size = 0xe2,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB_HEADER_SIZE, .payload = 0xe2 - SMB_HEADER_SIZE },
            .command.smb_command = SMB_COM_NT_CREATE_ANDX,
            .version = SMB_VERSION_1,
            .set_values = CIFS_PATH,
            .path = "\\ABCDEFG\\HIPQRSTUVWXY`OX\\VN",
            .tree_id = 0x880b,
            .meta_write_bytes = 0x69,
            .ids.multiplex_id = 0xcf47,
        }
    },

    {
        .name = "Smb2, Session setup request, NTLMSSP_NEGOCIATE",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x20,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x19, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58, 0x00, 0x53, 0x00,
//                                                          Gss-api---  Oid-------  1 3   6     1     5
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x51, 0x06, 0x06, 0x2b, 0x06, 0x01, 0x05,
//          5     2     Choice----  NegTokenIn  MechTypeLi  MecTypes--  MecOid----  OidMec----------------
            0x05, 0x02, 0xa0, 0x47, 0x30, 0x45, 0xa0, 0x0e, 0x30, 0x0c, 0x06, 0x0a, 0x2b, 0x06, 0x01, 0x04,
//          ----------------------------------  Choice-Mec  Octet-Stri  NTLMSSP---------------------------
            0x01, 0x82, 0x37, 0x02, 0x02, 0x0a, 0xa2, 0x33, 0x04, 0x31, 0x4e, 0x54, 0x4c, 0x4d, 0x53, 0x53,
//          ----------  NTLM message type-----
            0x50, 0x00, 0x01, 0x00, 0x00, 0x00, 0x15, 0x82, 0x08, 0x60, 0x09, 0x00, 0x09, 0x00, 0x20, 0x00,
            0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x29, 0x00, 0x00, 0x00, 0x57, 0x4f, 0x52, 0x4b, 0x47, 0x52,
            0x4f, 0x55, 0x50, 0x43, 0x43, 0x45, 0x4c, 0x4c, 0x49, 0x45, 0x52
        },
        .size = 0xab,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xab - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_SESSION_SETUP,
            .version = SMB_VERSION_2,
            .ids.message_id = 0x01,
        }
    },

    {
        .name = "Smb2, Session setup request, NTLMSSP_AUTH",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x20,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x9e, 0xa1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x19, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58, 0x00, 0x24, 0x01,
//                                                          NegTokenTarg----------  Sequence--------------
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa1, 0x82, 0x01, 0x20, 0x30, 0x82, 0x01, 0x1c,
//          Choice2-(RespToken---)  Octet-string----------  NTLMSSP
            0xa2, 0x82, 0x01, 0x18, 0x04, 0x82, 0x01, 0x14, 0x4e, 0x54, 0x4c, 0x4d, 0x53, 0x53, 0x50, 0x00,
            0x03, 0x00, 0x00, 0x00, 0x18, 0x00, 0x18, 0x00, 0x40, 0x00, 0x00, 0x00, 0x82, 0x00, 0x82, 0x00,
            0x58, 0x00, 0x00, 0x00, 0x12, 0x00, 0x12, 0x00, 0xda, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00,
            0xec, 0x00, 0x00, 0x00, 0x10, 0x00, 0x10, 0x00, 0xf4, 0x00, 0x00, 0x00, 0x10, 0x00, 0x10, 0x00,
            0x04, 0x01, 0x00, 0x00, 0x15, 0x82, 0x08, 0x60, 0x4a, 0x80, 0x60, 0x9e, 0x50, 0x1e, 0x6b, 0x56,
            0x41, 0xa8, 0xcd, 0x5e, 0x63, 0x37, 0xc9, 0x82, 0x37, 0x6b, 0x65, 0x72, 0x2f, 0xc8, 0x32, 0x79,
            0xe6, 0x41, 0xbb, 0xb5, 0x17, 0x46, 0x08, 0x20, 0xb6, 0x90, 0x1b, 0x69, 0x31, 0x4a, 0x2d, 0x64,
            0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x19, 0x48, 0x3e, 0x82, 0x9b, 0xcf, 0x01,
            0xb2, 0xb5, 0xc0, 0x05, 0xd6, 0x32, 0xf0, 0x86, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x16, 0x00,
            0x52, 0x00, 0x41, 0x00, 0x43, 0x00, 0x4b, 0x00, 0x53, 0x00, 0x54, 0x00, 0x41, 0x00, 0x54, 0x00,
            0x49, 0x00, 0x4f, 0x00, 0x4e, 0x00, 0x01, 0x00, 0x16, 0x00, 0x52, 0x00, 0x41, 0x00, 0x43, 0x00,
            0x4b, 0x00, 0x53, 0x00, 0x54, 0x00, 0x41, 0x00, 0x54, 0x00, 0x49, 0x00, 0x4f, 0x00, 0x4e, 0x00,
            0x04, 0x00, 0x00, 0x00, 0x03, 0x00, 0x16, 0x00, 0x52, 0x00, 0x61, 0x00, 0x63, 0x00, 0x6b, 0x00,
            0x53, 0x00, 0x74, 0x00, 0x61, 0x00, 0x74, 0x00, 0x69, 0x00, 0x6f, 0x00, 0x6e, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x57, 0x00, 0x4f, 0x00, 0x52, 0x00, 0x4b, 0x00, 0x47, 0x00, 0x52, 0x00, 0x4f, 0x00,
            0x55, 0x00, 0x50, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x74, 0x00, 0x6f, 0x00, 'F',  0x00, 'O',  0x00,
             'O', 0x00,  'O', 0x00,  'B', 0x00,  'A', 0x00,  'R', 0x00, 'L' , 0x00, 0x63, 0x18, 0x6a, 0x83,
            0x88, 0x44, 0xe6, 0x07, 0xab, 0xac, 0x16, 0x70, 0x91, 0x97, 0xaa, 0x9e
        },
        .size = 0x17c,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x17c - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_SESSION_SETUP,
            .version = SMB_VERSION_2,
            .set_values = CIFS_DOMAIN | CIFS_USER | CIFS_HOSTNAME,
            .ids.message_id = 2,
            .domain = "WORKGROUP",
            .user = "toto",
            .hostname = "FOOOBARL",
        }
    },

    {
        .name = "Smb2, Session setup request, NTLMSSP_AUTH",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x20,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x9e, 0xa1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x19, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x58, 0x00, 0x24, 0x01,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa1, 0x82, 0x01, 0x20, 0x30, 0x82, 0x01, 0x1c,
            0xa2, 0x82, 0x01, 0x18, 0x04, 0x82, 0x01, 0x14, 0x4e, 0x54, 0x4c, 0x4d, 0x53, 0x53, 0x50, 0x00,
            0x03, 0x00, 0x00, 0x00, 0x18, 0x00, 0x18, 0x00, 0x40, 0x00, 0x00, 0x00, 0x82, 0x00, 0x82, 0x00,
            0x58, 0x00, 0x00, 0x00, 0x12, 0x00, 0x12, 0x00, 0xda, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00,
            0xec, 0x00, 0x00, 0x00, 0x10, 0x00, 0x10, 0x00, 0xf4, 0x00, 0x00, 0x00, 0x10, 0x00, 0x10, 0x00,
            0x04, 0x01, 0x00, 0x00, 0x15, 0x82, 0x08, 0x60, 0x4a, 0x80, 0x60, 0x9e, 0x50, 0x1e, 0x6b, 0x56,
            0x41, 0xa8, 0xcd, 0x5e, 0x63, 0x37, 0xc9, 0x82, 0x37, 0x6b, 0x65, 0x72, 0x2f, 0xc8, 0x32, 0x79,
            0xe6, 0x41, 0xbb, 0xb5, 0x17, 0x46, 0x08, 0x20, 0xb6, 0x90, 0x1b, 0x69, 0x31, 0x4a, 0x2d, 0x64,
            0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x19, 0x48, 0x3e, 0x82, 0x9b, 0xcf, 0x01,
            0xb2, 0xb5, 0xc0, 0x05, 0xd6, 0x32, 0xf0, 0x86, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x16, 0x00,
            0x52, 0x00, 0x41, 0x00, 0x43, 0x00, 0x4b, 0x00, 0x53, 0x00, 0x54, 0x00, 0x41, 0x00, 0x54, 0x00,
            0x49, 0x00, 0x4f, 0x00, 0x4e, 0x00, 0x01, 0x00, 0x16, 0x00, 0x52, 0x00, 0x41, 0x00, 0x43, 0x00,
            0x4b, 0x00, 0x53, 0x00, 0x54, 0x00, 0x41, 0x00, 0x54, 0x00, 0x49, 0x00, 0x4f, 0x00, 0x4e, 0x00,
            0x04, 0x00, 0x00, 0x00, 0x03, 0x00, 0x16, 0x00, 0x52, 0x00, 0x61, 0x00, 0x63, 0x00, 0x6b, 0x00,
            0x53, 0x00, 0x74, 0x00, 0x61, 0x00, 0x74, 0x00, 0x69, 0x00, 0x6f, 0x00, 0x6e, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x57, 0x00, 0x4f, 0x00, 0x52, 0x00, 0x4b, 0x00, 0x47, 0x00, 0x52, 0x00, 0x4f, 0x00,
            0x55, 0x00, 0x50, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x74, 0x00, 0x6f, 0x00, 0x43, 0x00, 0x43, 0x00,
            0x45, 0x00, 0x4c, 0x00, 0x4c, 0x00, 0x49, 0x00, 0x45, 0x00, 0x52, 0x00, 0x63, 0x18, 0x6a, 0x83,
            0x88, 0x44, 0xe6, 0x07, 0xab, 0xac, 0x16, 0x70, 0x91, 0x97, 0xaa, 0x9e
        },
        .size = 0x17c,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x17c - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_SESSION_SETUP,
            .set_values = CIFS_DOMAIN | CIFS_USER | CIFS_HOSTNAME,
            .user = "toto",
            .domain = "WORKGROUP",
            .hostname = "CCELLIER",
            .version = SMB_VERSION_2,
            .ids.message_id = 0x02,
        }
    },

    {
        .name = "Smb2 tree connect request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0xe0, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x72, 0x4f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x09, 0x00, 0x00, 0x00, 0x48, 0x00, 0x2a, 0x00, 0x5c, 0x00, 0x5c, 0x00, 0x31, 0x00, 0x39, 0x00,
            0x32, 0x00, 0x2e, 0x00, 0x31, 0x00, 0x36, 0x00, 0x38, 0x00, 0x2e, 0x00, 0x38, 0x00, 0x30, 0x00,
            0x2e, 0x00, 0x32, 0x00, 0x32, 0x00, 0x35, 0x00, 0x5c, 0x00, 0x49, 0x00, 0x50, 0x00, 0x43, 0x00,
            0x24, 0x00
        },
        .size = 0x72,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x72 - SMB2_HEADER_SIZE },
            .set_values = CIFS_TREE,
            .command.smb2_command = SMB2_COM_TREE_CONNECT,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .tree = "\\\\192.168.80.225\\IPC$",
            .ids.message_id = 0x03,
        },
    },

    {
        .name = "Smb2 query directory request",
        .packet = (uint8_t const []) {
              0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x40, 0x1f,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x09, 0x85, 0x00, 0x00, 0x72, 0x4f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
              0x21, 0x00, 0x25, 0x00, 0x00, 0x00, 0x00, 0x00, 0x76, 0x33, 0x01, 0xf3, 0x47, 0xcf, 0x0d, 0x5b,
              0x76, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x0a, 0x00, 0xff, 0xff, 0x00, 0x00,
              0x73, 0x00, 0x70, 0x00, 0x65, 0x00, 0x63, 0x00, 0x73, 0x00
        },
        .size = 0x6a,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x6a - SMB2_HEADER_SIZE },
            .set_values = CIFS_PATH | CIFS_FID,
            .command.smb2_command = SMB2_COM_QUERY_DIRECTORY,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x5b0dcf47f3013376,
            .path = "specs",
            .tree_id = 0x8509,
            .ids.message_id = 0x08,
        },
    },

    {
        .name = "SMB2_COM_QUERY_DIRECTORY - response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x21, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x09, 0x85, 0x00, 0x00, 0x72, 0x4f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x09, 0x00, 0x48, 0x00, 0x72, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x31, 0xe5, 0xdd, 0xd9, 0x38, 0x95, 0xcf, 0x01, 0x1d, 0xd2, 0xf5, 0xa7, 0xfd, 0x99, 0xcf, 0x01,
            0x61, 0xc7, 0xa4, 0x5a, 0xfe, 0x99, 0xcf, 0x01, 0x61, 0xc7, 0xa4, 0x5a, 0xfe, 0x99, 0xcf, 0x01,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x34, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd4, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x73, 0x00, 0x70, 0x00, 0x65, 0x00, 0x63, 0x00, 0x73, 0x00
        },
        .size = 0xba,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xba - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_QUERY_DIRECTORY,
            .tree_id = 34057,
            .version = SMB_VERSION_2,
            .meta_read_bytes = 114,
            .ids.message_id = 8,
        },
    },

    {
        .name = "Smb2, create file request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x60, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x09, 0x85, 0x00, 0x00, 0x72, 0x4f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x39, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
            0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x79,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x79 - SMB2_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb2_command = SMB2_COM_CREATE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .path = "",
            .tree_id = 0x8509,
            .meta_write_bytes = 0x39,
            .ids.message_id = 0x07,
        },
    },

    {
        .name = "Smb2, create file request, with non empty file",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x20, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x9c, 0x83, 0x00, 0x00, 0xf0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x39, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x9f, 0x01, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x03, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x78, 0x00, 0x14, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x73, 0x00, 0x70, 0x00, 0x65, 0x00, 0x63, 0x00,
            0x73, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00, 0x74, 0x00
        },
        .size = 0x8c,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x8c - SMB2_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb2_command = SMB2_COM_CREATE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .path = "specs\\test",
            .tree_id = 0x839c,
            .meta_write_bytes = 0x4d,
            .ids.message_id = 0x09,
        },
    },

    {
        .name = "Smb2, create file response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x21, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x09, 0x85, 0x00, 0x00, 0x72, 0x4f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x59, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xd8, 0x0f, 0x60, 0x8c, 0xf2, 0x7f, 0xcf, 0x01,
            0x52, 0x6d, 0xe9, 0xc1, 0xc5, 0x9a, 0xcf, 0x01, 0xdd, 0x5b, 0xa6, 0xae, 0xfa, 0x99, 0xcf, 0x01,
            0xdd, 0x5b, 0xa6, 0xae, 0xfa, 0x99, 0xcf, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x76, 0x33, 0x01, 0xf3, 0x47, 0xcf, 0x0d, 0x5b, 0x76, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x98,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x98 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_CREATE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x5b0dcf47f3013376,
            .tree_id = 0x8509,
            .meta_read_bytes = 0x59,
            .ids.message_id = 0x07,
        },
    },

    {
        .name = "Smb2, close file request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x9c, 0x83, 0x00, 0x00, 0xf0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0x2d, 0xef, 0xd7, 0x78, 0x37, 0x5f, 0xff,
            0xd8, 0x2d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x58,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x58 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_CLOSE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0xff5f3778d7ef2dd8,
            .tree_id = 0x839c,
            .ids.message_id = 0x0a,
        },
    },

    {
        .name = "Smb2, write request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x1f,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x5e, 0xbd, 0x00, 0x00, 0xed, 0xb7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x31, 0x00, 0x70, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xc9, 0x3c, 0x4f, 0xe1, 0x77, 0xdb, 0xf5, 0x13, 0xc9, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x74, 0x6f, 0x74, 0x6f, 0x6c, 0x6f, 0x6c, 0x0a
        },
        .size = 0x78,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x78 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_WRITE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x13f5db77e14f3cc9,
            .query_write_bytes = 8,
            .tree_id = 0xbd5e,
            .ids.message_id = 0x0a,
        },
    },

    {
        .name = "Smb2, write response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x21, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x5e, 0xbd, 0x00, 0x00, 0xed, 0xb7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x11, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x50,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x50 - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_WRITE,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .response_write_bytes = 8,
            .tree_id = 0xbd5e,
            .ids.message_id = 0x0a,
        },
    },

    {
        .name = "Smb2, read request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0xe0, 0x1e,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x05, 0xec, 0x00, 0x00, 0x9e, 0xa1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x31, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xa0, 0x3e, 0x7d, 0x17, 0x45, 0xf8, 0x7d, 0x67, 0xa0, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00
        },
        .size = 0x71,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x71 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_READ,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x677df845177d3ea0,
            .tree_id = 0xec05,
            .ids.message_id = 0x0b,
        },
    },

    {
        .name = "Smb2, read response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x21, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x05, 0xec, 0x00, 0x00, 0x9e, 0xa1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x11, 0x00, 0x50, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x67, 0x72, 0x61, 0x0a
        },
        .size = 0x54,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x54 - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_READ,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .response_read_bytes = 4,
            .tree_id = 0xec05,
            .ids.message_id = 0x0b,
        }
    },

    {
        .name = "Smb2, query info request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0xa0, 0x1e,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x54, 0x16, 0x00, 0x00, 0xb6, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x29, 0x00, 0x01, 0x12, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8d, 0x1c, 0xe2, 0xad, 0x84, 0x07, 0x49, 0x54,
            0x8d, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x69,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x69 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_QUERY_INFO,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x54490784ade21c8d,
            .tree_id = 0x1654,
            .ids.message_id = 0x0d,
        }
    },

    {
        .name = "Smb2, query info response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x21, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x54, 0x16, 0x00, 0x00, 0xb6, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x09, 0x00, 0x48, 0x00, 0x7a, 0x00, 0x00, 0x00, 0x27, 0x45, 0xfc, 0xbc, 0x7d, 0x9b, 0xcf, 0x01,
            0xc6, 0x40, 0x7e, 0xf5, 0x09, 0xa1, 0xcf, 0x01, 0xb8, 0xd4, 0x9b, 0xf5, 0x05, 0xa1, 0xcf, 0x01,
            0xb8, 0xd4, 0x9b, 0xf5, 0x05, 0xa1, 0xcf, 0x01, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x96, 0x01, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x73, 0x00,
            0x70, 0x00, 0x65, 0x00, 0x63, 0x00, 0x73, 0x00, 0x5c, 0x00, 0x74, 0x00, 0x65, 0x00, 0x73, 0x00,
            0x74, 0x00
        },
        .size = 0xc2,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xc2 - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_QUERY_INFO,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .tree_id = 0x1654,
            .meta_read_bytes = 0x7a,
            .ids.message_id = 0x0d,
        }
    },

    {
        .name = "SMB2_COM_FLUSH request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x39, 0x00, 0x00, 0x88, 0x0c, 0x04, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x18, 0x00, 0x00, 0xe0, 0x02, 0x00, 0x00,
            0x11, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff
        },
        .size = 0x58,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x58 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_FLUSH,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x2e0000018010000,
            .tree_id = 0x1,
            .ids.message_id = 0xa9,
        }
    },

    {
        .name = "SMB2_COM_IOCTL - FSCTL_DFS_GET_REFERRALS request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x1d, 0x00, 0x00, 0x40, 0x33, 0x06, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x39, 0x00, 0x00, 0x00, 0x94, 0x01, 0x06, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x78, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x5c, 0x00, 0x61, 0x00, 0x75, 0x00,
            0x74, 0x00, 0x6f, 0x00, 0x2d, 0x00, 0x63, 0x00, 0x6f, 0x00, 0x6e, 0x00, 0x74, 0x00, 0x61, 0x00,
            0x63, 0x00, 0x74, 0x00, 0x2e, 0x00, 0x63, 0x00, 0x6f, 0x00, 0x5c, 0x00, 0x41, 0x00, 0x42, 0x00,
            0x5c, 0x00, 0x78, 0x00, 0x79, 0x00, 0x7a, 0x00, 0x78, 0x00, 0x79, 0x00, 0x7a, 0x00, 0x00, 0x00
        },
        .size = 0xb0,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xb0 - SMB2_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb2_command = SMB2_COM_IOCTL,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .path = "\\auto-contact.co\\AB\\xyzxyz",
            .tree_id = 0x1,
            .ids.message_id = 0x04,
        }
    },

    {
        .name = "SMB2_COM_IOCTL - FSCTL_PIPE_TRANSCEIVE request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x86, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x30, 0x12, 0x2c, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x39, 0x00, 0x00, 0x00, 0x17, 0xc0, 0x11, 0x00, 0x1e, 0x25, 0xc5, 0x24, 0x0b, 0x00, 0x00, 0x00,
            0x6d, 0x00, 0x30, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x5c, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x03, 0x10, 0x00, 0x00, 0x00,
            0x5c, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00,
            0x00, 0x00, 0x02, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00,
            0x5c, 0x00, 0x5c, 0x00, 0x42, 0x00, 0x52, 0x00, 0x41, 0x00, 0x43, 0x00, 0x41, 0x00, 0x53, 0x00,
            0x30, 0x00, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
            0x04, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
            0x00, 0x00, 0x00, 0x00
        },
        .size = 0xd4,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xd4 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_IOCTL,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0xb24c5251e,
            .tree_id = 0x9,
            .query_write_bytes = 0x5c,
            .ids.message_id = 0x0c86,
        }
    },

    {
        .name = "SMB2_COM_IOCTL - FSCTL_PIPE_TRANSCEIVE response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x01, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x61, 0x00, 0x00, 0x5c, 0x53, 0x06, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x31, 0x00, 0x00, 0x00, 0x17, 0xc0, 0x11, 0x00, 0x01, 0x94, 0x00, 0x00, 0xb0, 0x00, 0x00, 0x00,
            0x09, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x70, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x05, 0x00, 0x02, 0x03, 0x10, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
            0x18, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x17, 0x0c, 0x1b, 0xe9,
            0x75, 0x29, 0x25, 0x4c, 0x87, 0xca, 0xb2, 0x17, 0x93, 0xa8, 0xfc, 0x33, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0xa0,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xa0 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_IOCTL,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0xb000009401,
            .tree_id = 0x1,
            .response_read_bytes = 0x30,
            .ids.message_id = 0x16,
        }
    },

    {
        .name = "SMB2_COM_IOCTL - FSCTL_PIPE_WAIT request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf4, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x30, 0x12, 0x2c, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x39, 0x00, 0x00, 0x00, 0x18, 0x00, 0x11, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x78, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4d, 0x00, 0x4d, 0x00, 0x41, 0x00, 0x42, 0x00, 0x43, 0x00,
            0x44, 0x00, 0x45, 0x00, 0x46, 0x00
        },
        .size = 0x96,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x96 - SMB2_HEADER_SIZE },
            .set_values = CIFS_PATH,
            .command.smb2_command = SMB2_COM_IOCTL,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .path = "MMABCDEF",
            .tree_id = 0x9,
            .ids.message_id = 0x07f4,
        }
    },

    {
        .name = "SMB2_COM_IOCTL - FSCTL_GET_REPARSE_POINT request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x6d, 0x00, 0x00, 0xc0, 0x0b, 0x04, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x39, 0x00, 0x00, 0x00, 0xa8, 0x00, 0x09, 0x00, 0x05, 0xbe, 0x03, 0x00, 0x60, 0x03, 0x00, 0x00,
            0x05, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x78,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x78 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_IOCTL,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x3600003be05,
            .tree_id = 0x5,
            .ids.message_id = 0x0f,
        }
    },

    {
        .name = "SMB2_COM_IOCTL - FSCTL_CREATE_OR_GET_OBJECT_ID response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x02, 0x00,
            0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x05, 0x0e, 0x00, 0x5c, 0x08, 0x04, 0x00, 0x00,
            0x2c, 0xb5, 0x04, 0x90, 0xbc, 0x41, 0xa8, 0xae, 0x33, 0x1b, 0xa9, 0x61, 0xc3, 0x39, 0x66, 0xd6,
            0x31, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x09, 0x00, 0x01, 0x88, 0x02, 0x00, 0xf0, 0x01, 0x00, 0x00,
            0x21, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x70, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xa9, 0x15, 0x11, 0xb2, 0x41, 0x07, 0xe4, 0x11, 0x83, 0xf2, 0x00, 0x50, 0x56, 0xa5, 0x36, 0x98,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xa9, 0x15, 0x11, 0xb2, 0x41, 0x07, 0xe4, 0x11, 0x83, 0xf2, 0x00, 0x50, 0x56, 0xa5, 0x36, 0x98,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0xb0,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xb0 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_IOCTL,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x1f000028801,
            .tree_id = 0x1,
            .meta_read_bytes = 0x40,
            .ids.message_id = 0x0f2d,
        }
    },

    {
        .name = "SMB2_COM_LOCK - request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x81, 0x08, 0x00, 0x4c, 0x67, 0x04, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x30, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x72, 0x02, 0x00, 0x50, 0x03, 0x00, 0x00,
            0xfd, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x70,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x70 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_LOCK,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0x35000027201,
            .tree_id = 0x1,
            .ids.message_id = 0x012e,
        }
    },

    {
        .name = "SMB2_COM_CHANGE_NOTIFY - request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x30, 0x12, 0x2c, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x20, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xb9, 0x21, 0xc5, 0x24, 0x0b, 0x00, 0x00, 0x00,
            0x05, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x60,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x60 - SMB2_HEADER_SIZE },
            .set_values = CIFS_FID,
            .command.smb2_command = SMB2_COM_CHANGE_NOTIFY,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .fid = 0xb24c521b9,
            .tree_id = 0x1,
            .ids.message_id = 0x09,
        }
    },

    {
        .name = "SMB2_COM_CHANGE_NOTIFY - response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x01, 0x00, 0x03, 0x01, 0x00, 0x00, 0x0f, 0x00, 0x01, 0x00,
            0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf6, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x29, 0x00, 0x2c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x30, 0x12, 0x2c, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xdb
        },
        .size = 0x49,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x49 - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_CHANGE_NOTIFY,
            .status = NT_STATUS_PENDING,
            .version = SMB_VERSION_2,
            .response_write_bytes = 0,
            .tree_id = 0x0,
            .ids.message_id = 0x12f6,
        },
    },

    {
        .name = "SMB2_COM_SET_INFO - request",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xac, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0xff, 0xfe, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x6d, 0x00, 0x00, 0xc0, 0x0b, 0x04, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x21, 0x00, 0x01, 0x13, 0x08, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x0d, 0xb2, 0x02, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
            0x00, 0x7e, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00
        },
        .size = 0x68,
        .ret = PROTO_OK,
        .way = FROM_CLIENT,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0x68 - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_SET_INFO,
            .set_values = CIFS_FID,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .meta_write_bytes = 0x8,
            .fid = 0xc00002b20d,
            .tree_id = 0x5,
            .ids.message_id = 0xac,
        },
    },

    {
        .name = "SMB2_COM_NEGOCIATE - response",
        .packet = (uint8_t const []) {
            0xfe, 0x53, 0x4d, 0x42, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
            0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x41, 0x00, 0x01, 0x00, 0x10, 0x02, 0x00, 0x00, 0x72, 0x61, 0x63, 0x6b, 0x73, 0x74, 0x61, 0x74,
            0x69, 0x6f, 0x6e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
            0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x60, 0x28, 0x06, 0x06, 0x2b, 0x06, 0x01, 0x05, 0x05, 0x02, 0xa0, 0x1e, 0x30, 0x1c, 0xa0, 0x0e,
            0x30, 0x0c, 0x06, 0x0a, 0x2b, 0x06, 0x01, 0x04, 0x01, 0x82, 0x37, 0x02, 0x02, 0x0a, 0xa3, 0x0a,
            0x30, 0x08, 0xa0, 0x06, 0x1b, 0x04, 0x4e, 0x4f, 0x4e, 0x45
        },
        .size = 0xaa,
        .ret = PROTO_OK,
        .way = FROM_SERVER,
        .expected = {
            .info = { .head_len = SMB2_HEADER_SIZE, .payload = 0xaa - SMB2_HEADER_SIZE },
            .command.smb2_command = SMB2_COM_NEGOTIATE,
            .set_values = CIFS_SERVER_HOSTNAME,
            .status = SMB_STATUS_OK,
            .version = SMB_VERSION_2,
            .hostname = "rackstation",
            .ids.message_id = 0x00,
        },
    },

};

#define CHECK_SMB_SET(INFO, EXPECTED, MASK) \
    check_set_values(INFO->set_values, EXPECTED->set_values, MASK, #MASK);

static unsigned cur_test;


#define CHECK_FLAG_FILE(INFO, EXPECTED, MASK) \
    check_set_values(INFO->flag_file, EXPECTED->flag_file, MASK, #MASK);

static int compare_expected_cifs(struct cifs_proto_info const *const info,
        struct cifs_proto_info const *const expected)
{
    CHECK_INT(info->info.head_len, expected->info.head_len);
    CHECK_INT(info->info.payload, expected->info.payload);

    CHECK_SET_VALUE(info, expected, CIFS_DOMAIN);
    CHECK_SET_VALUE(info, expected, CIFS_USER);
    CHECK_SET_VALUE(info, expected, CIFS_PATH);
    CHECK_SET_VALUE(info, expected, CIFS_TRANS2_SUBCMD);
    CHECK_SET_VALUE(info, expected, CIFS_LEVEL_OF_INTEREST);
    CHECK_SET_VALUE(info, expected, CIFS_FID);
    CHECK_SET_VALUE(info, expected, CIFS_HOSTNAME);
    CHECK_SET_VALUE(info, expected, CIFS_DRIVER);
    CHECK_SET_VALUE(info, expected, CIFS_OS);
    CHECK_SET_VALUE(info, expected, CIFS_SERVER_HOSTNAME);
    CHECK_SET_VALUE(info, expected, CIFS_SERVER_DRIVER);
    CHECK_SET_VALUE(info, expected, CIFS_SERVER_OS);

    CHECK_INT(info->tree_id, expected->tree_id);
    CHECK_INT(info->version, expected->version);
    CHECK_INT(info->status, expected->status);
    CHECK_INT(info->command.smb_command, expected->command.smb_command);
    CHECK_INT(info->query_write_bytes, expected->query_write_bytes);
    CHECK_INT(info->response_read_bytes,  expected->response_read_bytes);
    CHECK_INT(info->response_write_bytes, expected->response_write_bytes);
    CHECK_INT(info->meta_read_bytes,  expected->meta_read_bytes);
    CHECK_INT(info->meta_write_bytes,  expected->meta_write_bytes);
    if (info->version == SMB_VERSION_1) CHECK_INT(info->ids.multiplex_id, expected->ids.multiplex_id);
    else CHECK_BIG_INT(info->ids.message_id, expected->ids.message_id);

    if (VALUES_ARE_SET(info, CIFS_DOMAIN))
        CHECK_STR(info->domain, expected->domain);
    if (VALUES_ARE_SET(info, CIFS_USER))
        CHECK_STR(info->user, expected->user);

    if (VALUES_ARE_SET(info, CIFS_SERVER_HOSTNAME))
        CHECK_STR(info->hostname, expected->hostname);
    if (VALUES_ARE_SET(info, CIFS_SERVER_DRIVER))
        CHECK_STR(info->driver, expected->driver);
    if (VALUES_ARE_SET(info, CIFS_SERVER_OS))
        CHECK_STR(info->os, expected->os);

    if (VALUES_ARE_SET(info, CIFS_HOSTNAME))
        CHECK_STR(info->hostname, expected->hostname);
    if (VALUES_ARE_SET(info, CIFS_DRIVER))
        CHECK_STR(info->driver, expected->driver);
    if (VALUES_ARE_SET(info, CIFS_OS))
        CHECK_STR(info->os, expected->os);

    if (VALUES_ARE_SET(info, CIFS_TREE))
        CHECK_STR(info->tree, expected->tree);
    if (VALUES_ARE_SET(info, CIFS_PATH))
        CHECK_STR(info->path, expected->path);
    if (VALUES_ARE_SET(info, CIFS_TRANS2_SUBCMD))
        CHECK_INT(info->subcommand.trans2_subcmd, expected->subcommand.trans2_subcmd);
    if (VALUES_ARE_SET(info, CIFS_TRANSACTION_SUBCMD))
        CHECK_INT(info->subcommand.transaction_subcmd, expected->subcommand.transaction_subcmd);
    if (VALUES_ARE_SET(info, CIFS_NT_TRANSACT_SUBCMD))
        CHECK_INT(info->subcommand.nt_transact_subcmd, expected->subcommand.nt_transact_subcmd);
    if (VALUES_ARE_SET(info, CIFS_LEVEL_OF_INTEREST))
        CHECK_INT(info->level_of_interest, expected->level_of_interest);
    if (VALUES_ARE_SET(info, CIFS_FID))
        CHECK_BIG_INT(info->fid, expected->fid);

    CHECK_FLAG_FILE(info, expected, CIFS_FILE_CREATE);
    CHECK_FLAG_FILE(info, expected, CIFS_FILE_DIRECTORY);
    CHECK_FLAG_FILE(info, expected, CIFS_FILE_UNLINK);

    return 0;
}

static unsigned called = 0;
static void cifs_info_check(struct proto_subscriber unused_ *s, struct proto_info const *info_,
        size_t unused_ cap_len, uint8_t const unused_ *packet, struct timeval const unused_ *now)
{
    // Check info against parse_tests[cur_test].expected
    struct cifs_proto_info const *const info = DOWNCAST(info_, info, cifs_proto_info);
    struct cifs_proto_info const *const expected = &parse_tests[cur_test].expected;
    assert(0 == compare_expected_cifs(info, expected));
    called++;
}

static void parse_check(void)
{
    struct timeval now;
    timeval_set_now(&now);
    struct parser *parser = proto_cifs->ops->parser_new(proto_cifs);
    struct parser *parser_netbios = proto_netbios->ops->parser_new(proto_netbios);
    struct proto_subscriber sub;
    hook_subscriber_ctor(&pkt_hook, &sub, cifs_info_check);
    struct netbios_proto_info netbios_proto_info;

    for (cur_test = 0; cur_test < NB_ELEMS(parse_tests); cur_test++) {
        struct parse_test const *test = parse_tests + cur_test;
        printf("Check packet %d '%s' of size 0x%x (%d)\n", cur_test, test->name, test->size, test->size);
        netbios_proto_info_ctor(&netbios_proto_info, parser_netbios, NULL, NETBIOS_HEADER_SIZE, test->size, test->size);
        enum proto_parse_status ret = cifs_parse(parser, &netbios_proto_info.info, test->way, test->packet, test->size,
                test->size, &now, test->size, test->packet);
        assert(ret == test->ret);
        assert(called == cur_test + 1);
    }
    hook_subscriber_dtor(&pkt_hook, &sub);
}

static void compute_padding_check()
{
    struct cursor cursor = {.cap_len = 0x37 };
    assert(1 == compute_padding(&cursor, 0, 2));
    assert(0 == compute_padding(&cursor, 1, 2));
    assert(3 == compute_padding(&cursor, 0, 4));
}

int main(void)
{
    log_init();
    ext_init();
    mutex_init();
    objalloc_init();
    proto_init();
    pkt_wait_list_init();
    ref_init();
    cap_init();
    eth_init();
    ip_init();
    ip6_init();
    tcp_init();
    netbios_init();
    cifs_init();
    log_set_level(LOG_DEBUG, NULL);
    log_set_level(LOG_WARNING, "mutex");
    log_set_file("cifs_check.log");

    compute_padding_check();
    parse_check();

    cifs_fini();
    netbios_fini();
    tcp_fini();
    ip6_fini();
    ip_fini();
    eth_fini();
    cap_fini();
    ref_fini();
    pkt_wait_list_fini();
    proto_fini();
    objalloc_fini();
    mutex_fini();
    ext_fini();
    log_fini();
    return EXIT_SUCCESS;
}

